<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/devices/arduino/api/network.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>TheThingsNetwork - The Things Network</title>
<meta property="og:title" content="TheThingsNetwork" />
<meta name="description" content="API Reference The TheThingsNetwork class enables Arduino devices with supported LoRa modules to communicate via The Things Network." />
<meta property="og:description" content="API Reference The TheThingsNetwork class enables Arduino devices with supported LoRa modules to communicate via The Things Network." />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/devices/arduino/api/network.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/devices/arduino/api/network.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-04T23:11:52+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "TheThingsNetwork",
"image": "https://www.thethingsnetwork.org/docs/assets/images/og-image.png",
"datePublished": "2017-02-04T23:11:52+00:00",
"description": "API Reference The TheThingsNetwork class enables Arduino devices with supported LoRa modules to communicate via The Things Network.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},
"url": "https://www.thethingsnetwork.org/docs/devices/arduino/api/network.html"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Building a Global Internet of Things Network Together.">
    <meta name="msapplication-config" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/ieconfig.xml">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-32.png" sizes="32x32">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-57.png" sizes="57x57">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-76.png" sizes="76x76">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-96.png" sizes="96x96">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-120.png" sizes="120x120">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-128.png" sizes="128x128">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png" sizes="144x144">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png" sizes="152x152">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-180.png" sizes="180x180">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-195.png" sizes="195x195">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-228.png" sizes="228x228">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/smalltile.png" sizes="128x128">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/mediumtile.png" sizes="270x270">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/widetile.png" sizes="558x270">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-196.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="content">
<div class="layout-page">
  <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="⛅ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div>
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class="active"><a href="/docs/devices/">Devices</a></li>
                <li class=""><a href="/docs/gateways/">Gateways</a></li>
                <li class=""><a href="/docs/network/">Network</a></li>
                <li class=""><a href="/docs/applications/">Applications</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/docs/TheThingsNetwork.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>network.md</strong></a>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <div class="panel page-side-nav page-affix">
          <div class="panel-body">
            <h5>Devices</h5>
            <ul>
              <li class=""><a href="/docs/devices/index.html">Overview</a>
            <ul>
                <li class=""><a href="/docs/devices/registration.html">Device Registration</a>
                </li>
                <li class=""><a href="/docs/devices/bytes.html">Working with Bytes</a>
                </li>
            </ul>
              </li>
            <li class="page-side-nav-section"><span>SDKs & Libraries</span>
            <ul>
                <li class=""><a href="/docs/devices/arduino/">Arduino</a>
            <ul>
                <li class=""><a href="/docs/devices/arduino/ide.html">IDE Setup & Usage</a>
                </li>
                <li class=""><a href="/docs/devices/arduino/usage.html">Library Usage</a>
                </li>
                <li class=""><a href="/docs/devices/arduino/api/network.html">API Reference</a>
                    <i class="fa fa-link"></i>
            <ul>
                <li class="active"><a href="/docs/devices/arduino/api/network.html">TheThingsNetwork</a>
                </li>
                <li class=""><a href="/docs/devices/arduino/api/message.html">TheThingsMessage</a>
                </li>
                <li class=""><a href="/docs/devices/arduino/api/../../node/api.html">TheThingsNode</a>
                    <i class="fa fa-link"></i>
                    <span class="label label-info">draft</span>
                </li>
            </ul>
                </li>
            </ul>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Hardware</span>
            <ul>
                <li class=""><a href="/docs/devices/uno/">The Things Uno</a>
                </li>
                <li class=""><a href="/docs/devices/node/">The Things Node</a>
                    <span class="label label-info">draft</span>
                </li>
                <li class=""><a href="/docs/devices/lopy/">LoPy</a>
                </li>
            </ul>
            </li>
                <li class="page-side-nav-section"><span>Links <i class="fa fa-link"></i></span>
                  <ul>
                      <li class=""><a href="/docs/devices/../network/migrate.html">Migrate form Staging to Production</a></li>
                  </ul>
                </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-sm-7">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="api-reference">API Reference</h1>
<p>The <code class="highlighter-rouge">TheThingsNetwork</code> class enables Arduino devices with supported LoRa modules to communicate via The Things Network.</p>
<h2 id="class-thethingsnetwork">Class: TheThingsNetwork</h2>
<p>Include and instantiate the TheThingsNetwork class. The constructor initialize the library with the Streams it should communicate with. It also sets the value of the spreading factor, the front-side Bus and the frequency plan.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span>
<span class="n">TheThingsNetwork</span> <span class="n">ttn</span><span class="p">(</span><span class="n">Stream</span><span class="o">&amp;</span> <span class="n">modemStream</span><span class="p">,</span> <span class="n">Stream</span><span class="o">&amp;</span> <span class="n">debugStream</span><span class="p">,</span> <span class="n">fp_ttn_t</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">sf</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">fsb</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">Stream&amp; modemStream</code>: Stream for the LoRa modem (for The Things Node/Uno use <code class="highlighter-rouge">Serial1</code> and data rate <code class="highlighter-rouge">57600</code>).</li>
  <li><code class="highlighter-rouge">Stream&amp; debugStream</code>: Stream to write debug logs to (for The Things Node/Uno use <code class="highlighter-rouge">Serial</code> and data rate <code class="highlighter-rouge">9600</code>).</li>
  <li><code class="highlighter-rouge">fp_ttn_fp fp</code>: The frequency plan: <code class="highlighter-rouge">TTN_FP_EU868</code> or <code class="highlighter-rouge">TTN_FP_US915</code> depending on the region you deploy in.</li>
  <li><code class="highlighter-rouge">uint8_t sf = 7</code>: Optional custom spreading factor. Can be <code class="highlighter-rouge">7</code> to <code class="highlighter-rouge">12</code> for <code class="highlighter-rouge">TTN_FP_EU868</code> and <code class="highlighter-rouge">7</code> to <code class="highlighter-rouge">12</code> for <code class="highlighter-rouge">TTN_FP_US915</code>. Defaults to <code class="highlighter-rouge">7</code>.</li>
  <li><code class="highlighter-rouge">uint8_t fsb = 2</code>: Optional custom front-side bus. Can be <code class="highlighter-rouge">1</code> to <code class="highlighter-rouge">8</code>. Defaults to <code class="highlighter-rouge">2</code>.</li>
</ul>
<h2 id="method-showstatus">Method: showStatus</h2>
<p>Writes information about the device and LoRa module to <code class="highlighter-rouge">debugStream</code>.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="n">showStatus</span><span class="p">();</span>
</code></pre>
</div>
<p>Will write something like:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>EUI: 0004A30B001B7AD2
Battery: 3223
AppEUI: 70B3D57EF000001C
DevEUI: 0004A30B001B7AD2
Band: 868
Data Rate: 5
RX Delay 1: 1000
RX Delay 2: 2000
Total airtime: 0.00 s
</code></pre>
</div>
<p>See the <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/DeviceInfo/DeviceInfo.ino">DeviceInfo</a> example.</p>
<h2 id="method-onmessage">Method: onMessage</h2>
<p>Sets a function which will be called to process incoming messages. You’ll want to do this in your <code class="highlighter-rouge">setup()</code> function and then define a <code class="highlighter-rouge">void (*cb)(const byte* payload, size_t length, port_t port)</code> function somewhere else in your sketch.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="n">onMessage</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cb</span><span class="p">)(</span><span class="k">const</span> <span class="n">byte</span><span class="o">*</span> <span class="n">payload</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="n">port_t</span> <span class="n">port</span><span class="p">));</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">const byte* payload</code>: Bytes received.</li>
  <li><code class="highlighter-rouge">size_t length</code>: Number of bytes.</li>
  <li><code class="highlighter-rouge">port_t port</code>: The port addressed.</li>
</ul>
<p>See the <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/Receive/Receive.ino">Receive</a> example.</p>
<h2 id="method-join">Method: join</h2>
<p>Activate the device via OTAA (default).</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">bool</span> <span class="n">join</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appEui</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appKey</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">retries</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">retryDelay</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">);</span>
<span class="n">bool</span> <span class="n">join</span><span class="p">(</span><span class="kt">int8_t</span> <span class="n">retries</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">retryDelay</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">const char *appEui</code>: Application EUI the device is registered to.</li>
  <li><code class="highlighter-rouge">const char *appKey</code>: Application Key assigned to the device.</li>
  <li><code class="highlighter-rouge">int8_t retries = -1</code>: Number of times to retry after failed or unconfirmed join. Defaults to <code class="highlighter-rouge">-1</code> which means infinite.</li>
  <li><code class="highlighter-rouge">uint32_t retryDelay = 10000</code>: Delay in ms between attempts. Defaults to 10 seconds.</li>
</ul>
<p>Returns <code class="highlighter-rouge">true</code> or <code class="highlighter-rouge">false</code> depending on whether it received confirmation that the activation was successful before the maximum number of attempts.</p>
<p>Call the method without the first two arguments if the device’s LoRa module comes with pre-flashed values.</p>
<h2 id="method-personalize">Method: personalize</h2>
<p>Activate the device via ABP.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">bool</span> <span class="n">personalize</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">devAddr</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">nwkSKey</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appSKey</span><span class="p">);</span>
<span class="n">bool</span> <span class="n">personalize</span><span class="p">();</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">const char *devAddr</code>: Device Address assigned to the device.</li>
  <li><code class="highlighter-rouge">const char *nwkSKey</code>: Network Session Key assigned to the device for identification.</li>
  <li><code class="highlighter-rouge">const char *appSKey</code>: Application Session Key assigned to the device for encryption.</li>
</ul>
<p>Returns <code class="highlighter-rouge">true</code> or <code class="highlighter-rouge">false</code> depending on whether the activation was successful.</p>
<p>Call the method with no arguments if the device’s LoRa module comes with pre-flashed values.</p>
<p>See the <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/ABP/ABP.ino">ABP</a> example.</p>
<h2 id="method-sendbytes">Method: sendBytes</h2>
<p>Send a message to the application using raw bytes.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">ttn_response_t</span> <span class="n">sendBytes</span><span class="p">(</span><span class="k">const</span> <span class="n">byte</span><span class="o">*</span> <span class="n">payload</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="n">port_t</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bool</span> <span class="n">confirm</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">const byte* payload </code>: Bytes to send.</li>
  <li><code class="highlighter-rouge">size_t length</code>: The number of bytes. Use <code class="highlighter-rouge">sizeof(payload)</code> to get it.</li>
  <li><code class="highlighter-rouge">port_t port = 1</code>: The port to address. Defaults to <code class="highlighter-rouge">1</code>.</li>
  <li><code class="highlighter-rouge">bool confirm = false</code>: Whether to ask for confirmation. Defaults to <code class="highlighter-rouge">false</code>. If confirmation fails, the method will return error code <code class="highlighter-rouge">TTN_ERROR_UNEXPECTED_RESPONSE</code>.</li>
</ul>
<p>Returns a success or error code and logs the related error message:</p>
<ul>
  <li><code class="highlighter-rouge">TTN_ERROR_SEND_COMMAND_FAILED</code>: Send command failed.</li>
  <li><code class="highlighter-rouge">TTN_SUCCESSFUL_TRANSMISSION</code>: Successful transmission.</li>
  <li><code class="highlighter-rouge">TTN_SUCCESSFUL_RECEIVE</code>: Successful transmission. Received &lt;N&gt; bytes</li>
  <li><code class="highlighter-rouge">TTN_ERROR_UNEXPECTED_RESPONSE</code>: Unexpected response: &lt;Response&gt;</li>
</ul>
<p>See the <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/Send/Send.ino">Send</a> example.</p>
<p>Also in sendBytes, due to TTN’s 30 second fair access policy, we update the airtime each time we uplink a message. This airtime is based on a lot of variables but the most important ones are the spreading factor and the size of the message, the higher it is the less messages you can send in 30 seconds (SF7 around 500 messages of 8 bytes, SF12 around 20 messages of 8 bytes).</p>
<h2 id="method-poll">Method: poll</h2>
<p>Calls <code class="highlighter-rouge">sendBytes()</code> with <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">0x00</span><span class="w"> </span><span class="p">}</span></code> as payload to poll for incoming messages.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">int8_t</span> <span class="n">poll</span><span class="p">(</span><span class="n">port_t</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bool</span> <span class="n">confirm</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">port_t port = 1</code>: The port to address. Defaults to <code class="highlighter-rouge">1</code>.</li>
  <li><code class="highlighter-rouge">bool confirm = false</code>: Whether to ask for confirmation.</li>
</ul>
<p>Returns the result of <code class="highlighter-rouge">sendBytes()</code>.</p>
<p>See the <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/Receive/Receive.ino">Receive</a> example.</p>
<h2 id="method-provision">Method: provision</h2>
<p>Sets the information needed to activate the device via OTAA, without actually activating. Call join() without the first 2 arguments to activate.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">bool</span> <span class="n">provision</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appEui</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appKey</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">const char *appEui</code>: Application Identifier for the device.</li>
  <li><code class="highlighter-rouge">const char *appKey</code>: Application Key assigned to the device.</li>
</ul>
<h2 id="method-calculateairtime">Method: calculateAirtime</h2>
<p>Calculate the uplink time of a message.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">float</span> <span class="n">calculateAirtime</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">payloadSize</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">size_t payloadSize</code>: number of bytes you want to send.</li>
</ul>
<p>Returns the uplink time of the message in seconds.</p>
<h2 id="method-sleep">Method: sleep</h2>
<p>Sleep the LoRa module for a specified number of milliseconds.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="n">sleep</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mseconds</span><span class="p">);</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">unsigned long mseconds</code>: number of milliseconds to sleep.</li>
</ul>
          </div>
        </div>
      </div>
      <div class="hidden-xs col-sm-2">
        <div class="page-toc page-affix"></div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <script src="https://www.thethingsnetwork.org/navbar.js"></script>
    <script src="https://ttnstaticfile.blob.core.windows.net/static/common/js/ga.js"></script>
  </body>
</html>
