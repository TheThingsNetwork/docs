---
title: API Reference
zindex: -1000
source: 'https://github.com/TheThingsNetwork/node-app-sdk/blob/master/DOCUMENTATION.md'
---

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Application](#application)
-   [key](#key)
-   [is-token](#is-token)
-   [setup](#setup)
-   [PayloadFunctions](#payloadfunctions)
-   [open](#open)
-   [ApplicationClient](#applicationclient)
    -   [constructor](#constructor)
    -   [get](#get)
    -   [setPayloadFormat](#setpayloadformat)
    -   [setCustomPayloadFunctions](#setcustompayloadfunctions)
    -   [setRegisterOnJoinAccessKey](#setregisteronjoinaccesskey)
    -   [unregister](#unregister)
    -   [devices](#devices)
    -   [registerDevice](#registerdevice)
    -   [device](#device)
    -   [updateDevice](#updatedevice)
    -   [deleteDevice](#deletedevice)
-   [DiscoveryOptions](#discoveryoptions)
-   [HandlerClient](#handlerclient)
    -   [open](#open-1)
    -   [data](#data)
    -   [application](#application-1)
-   [DataClient](#dataclient)
    -   [constructor](#constructor-1)
    -   [close](#close)
    -   [end](#end)
    -   [on](#on)
    -   [off](#off)
    -   [send](#send)
-   [ApplicationSettings](#applicationsettings)
-   [application](#application-2)
-   [Service](#service)
-   [app](#app)
-   [Announcement](#announcement)
-   [data](#data-1)
-   [Discovery](#discovery)
    -   [constructor](#constructor-2)
    -   [getAll](#getall)
    -   [get](#get-1)
    -   [getByAppID](#getbyappid)
-   [services](#services)
    -   [Handler](#handler)
    -   [Router](#router)
    -   [Broker](#broker)

## Application

Application is an application on the network.

Type: {appId: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), payloadFormat: PayloadFormat, decoder: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, converter: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, validator: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, encoder: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, registerOnJoinAccessKey: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?}

**Properties**

-   `appId` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `payloadFormat` **PayloadFormat** 
-   `decoder` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `converter` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `validator` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `encoder` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `registerOnJoinAccessKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 

## key

Generates a new key to be used for Lora

**Parameters**

-   `length` **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)**  (optional, default `16`)

## is-token

Returns true if the passed in string
is a json web token, and false otherwise.
It does NOT validate the token signature.

**Parameters**

-   `str` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

## 

A token that can register ApplicationSettings

## setup

Setup function that prepares the environment with the required
application and devices for testing.

## PayloadFunctions

PayloadFunctions is an object that bundles the payload functions of an
application.

Type: {decoder: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, converter: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, validator: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, encoder: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?}

**Properties**

-   `decoder` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `converter` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `validator` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `encoder` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 

## open

`open` creates and opens a HandlerClient for the application with the specified ID.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The ID of the application you want to manage.
-   `accessKerOrToken` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `opts` **[DiscoveryOptions](#discoveryoptions)?** Optional options to pass to the Discovery client.
-   `tokenOrKey`  The Access Token or Access Key used to authenticate.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[HandlerClient](#handlerclient)>** 

## ApplicationClient

A client that manages devices on the handler.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `tokenOrKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `netAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `certificate` **([Buffer](https://nodejs.org/api/buffer.html) \| [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))?** 

### constructor

Create and open an application manager client that can be used for
retreiving and updating an application and its devices.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The ID of the application you want to manage
-   `tokenOrKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The Access Token or Access Key used to authenticate
-   `netAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The gRPC address of the handler where the application is registered
-   `certificate` **([Buffer](https://nodejs.org/api/buffer.html) \| [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))?** An optional certificate used to connect to the handler securely

Returns **void** 

### get

Get the application

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Application](#application)>** 

### setPayloadFormat

Change the payload format of the application.

**Parameters**

-   `format` **PayloadFormat** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

### setCustomPayloadFunctions

Set the custom payload functions of the application and set the format
to custom.

**Parameters**

-   `fns` **[PayloadFunctions](#payloadfunctions)**  (optional, default `{}`)

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

### setRegisterOnJoinAccessKey

Set the registerOnJoinAccessKey or remove it.

**Parameters**

-   `to` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

### unregister

Unregister the application from the handler.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

### devices

List the devices of the application

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Device>>** 

### registerDevice

Register a device in the application.

**Parameters**

-   `devID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `device` **DeviceUpdates** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

### device

Get the device specified by the devID

**Parameters**

-   `devID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;Device>** 

### updateDevice

Update the device specified by the devID with the specified updates

**Parameters**

-   `devID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `updates` **DeviceUpdates** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

### deleteDevice

Delete the specified device.

**Parameters**

-   `devID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

## DiscoveryOptions

Type: {address: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, insecure: [boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, certificate: ([Buffer](https://nodejs.org/api/buffer.html) \| [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))?}

**Properties**

-   `address` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `insecure` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** 
-   `certificate` **([Buffer](https://nodejs.org/api/buffer.html) \| [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))?** 

## HandlerClient

`Handler` is a  client for The Things Network handler APIs.
It can be used to get data from an application or to manage devices.

Example:

    const handler = new Handler("my-app-id", "my-app-access-key")

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `appAccessKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `opts` **[DiscoveryOptions](#discoveryoptions)?** 

### open

`open` opens the client to the handler.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[HandlerClient](#handlerclient)>** 

### data

Open a data client that can be used to receive live application data

Returns **[DataClient](#dataclient)** 

### application

Open a application manager that can be used to manage the settings and devices of the
application.

Returns **[ApplicationClient](#applicationclient)** 

## DataClient

DataClient is a client for The Things Network data API.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `appAccessKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `mqttAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### constructor

Creates a new DataClient and opens the MQTT connection.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `appAccessKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `mqttAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **void** 

### close

Close the mqtt connection

**Parameters**

-   `force` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** passing it to true will close the client right away, without waiting for the in-flight messages to be acked
-   `callback` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)?** will be called when the client is closed

### end

Same as close (for backwards compatibility).

**Parameters**

-   `force` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** 
-   `callback` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)?** 

### on

Starts listening to events.

Possible events are:

-   `uplink` (or `message`): Messages sent by the devices to the appliction.
-   `activation`: An alias for the `activations` (see `event`)
-   `event` (or `device`): Events that happen to devices. You can filter on
    the events by adding more parameters. For instance:
    -   `downlink/scheduled`
    -   `downlink/sent`
    -   `activations`
    -   `create`
    -   `update`
    -   `delete`
    -   `down/acks`
    -   `up/errors`
    -   `down/errors`
    -   `activations/errors`

See [The MQTT API Reference](https://www.thethingsnetwork.org/docs/applications/mqtt/api.html)
for more information about these events and what their payloads look like.

**Parameters**

-   `event` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The name of the event to listen to.
-   `args` **...[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>** 
-   `devID`  An optional devID. If not passed will subscribe to the event for all devices.
-   `callback`  The callback to call when the event occurs.

**Examples**

```javascript
// listens to all uplinks from all devices
client.on("uplink", function (devID, message) {})
```

```javascript
// listens to all uplinks from the device with id `foo`
client.on("uplink", "foo", function (devID, message) {})
```

```javascript
// listens to all device events for all devices
client.on("event", function (devID, message) {})
```

```javascript
// listens to all device events for device with id `foo`
client.on("event", "foo", function (devID, message) {})
```

```javascript
// listens to the `downlink/scheduled` events for device with id `foo`
client.on("event", "foo", "downlink/scheduled", function (devID, message) {})
```

```javascript
// listens to the `downlink/scheduled` events for all devices
client.on("event", "+", "downlink/scheduled", function (devID, message) {})
```

Returns **void** 

### off

Stop listening to events.
The argument structure is the same as for `on()`.

**Parameters**

-   `event` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `args` **...[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>** 

Returns **void** 

### send

Send a downlink message to the device with the specified device ID.

**Parameters**

-   `devID` **DeviceID** The device ID of the device to send the downlink to.
-   `payload` **(PayloadArray | PayloadRaw | PayloadFields)** The raw payload as a Buffer or an Array or an object of payload fields.
-   `port` **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The port to send the message on.
-   `confirmed` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Set to true for confirmed downlink.

## ApplicationSettings

ApplicationSettings hold the settings of an application.

Type: {payloadFormat: PayloadFormat?, registerOnJoinAccessKey: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?}

**Properties**

-   `payloadFormat` **PayloadFormat?** 
-   `registerOnJoinAccessKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 

## application

`application` creates and opens an ApplicationClient for the application with the specified ID.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The ID of the application you want to manage
-   `accessKeyOrToken` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The Access Token or Access Key used to authenticate
-   `opts` **[DiscoveryOptions](#discoveryoptions)?** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[ApplicationClient](#applicationclient)>** 

## Service

Service is an enum of the possible services types to get from the discovery
server.

Type: (`"router"` \| `"broker"` \| `"handler"`)

## 

Settings for the discovery server

## app

The app used for testing

## Announcement

Announcement is an announcement on the discovery server.

Type: {id: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), serviceName: [Service](#service), serviceVersion: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), description: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), pb_public: [boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean), url: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), netAddress: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), mqttAddress: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), apiAddress: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), publicKey: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, certificate: [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?, metadataList: [Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>?}

**Properties**

-   `id` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `serviceName` **[Service](#service)** 
-   `serviceVersion` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `description` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `pb_public` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 
-   `url` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `netAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `mqttAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `apiAddress` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `publicKey` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `certificate` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
-   `metadataList` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>?** 

## data

`data` creates and opens an DataClient for the application with the specified ID.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The ID of the application you want to manage
-   `accessKeyOrToken` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The Access Token or Access Key used to authenticate
-   `opts` **[DiscoveryOptions](#discoveryoptions)?** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[DataClient](#dataclient)>** 

## 

Settings for the handler

## Discovery

Discovery is a client for The Things Network discovery API

**Parameters**

-   `opts` **[DiscoveryOptions](#discoveryoptions)**  (optional, default `{}`)

### constructor

Create a new Discovery client.

**Parameters**

-   `opts` **[DiscoveryOptions](#discoveryoptions)**  (optional, default `{}`)

Returns **void** 

### getAll

`getAll` returns announcements for all services known to
the discovery server that match the service name.

**Parameters**

-   `serviceName` **[Service](#service)** The name of the services to look for, eg. `"handler"`

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Announcement](#announcement)>>** 

### get

`get` returns the announcement for the service with the
specified service name and id.

**Parameters**

-   `serviceName` **[Service](#service)** The name of the services to look for, eg. `"handler"`
-   `id` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The id of the service to look for, eg. `"ttn-handler-eu"`

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Announcement](#announcement)>** 

### getByAppID

`getByAppID` gets a handler announcement by application ID.
It looks up the handler the application is registered to.

**Parameters**

-   `appID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Announcement](#announcement)>** 

## services

services is a map with the known service names for the discovery server.

Type: {}

### Handler

Handler is a Handler service

### Router

Router is a Router service

### Broker

Broker is a Broker service
