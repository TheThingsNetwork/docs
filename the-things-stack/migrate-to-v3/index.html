<!DOCTYPE html>

<html lang="en-us" class="has-ttn-navbar-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <meta name="generator" content="Hugo 0.88.1" />

  <title>Migrate your Gateways and Devices | The Things Network</title>
  <link rel="canonical" href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/" />
  

  <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">

  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">

  <meta name="application-name" content="The Things Network">
  <meta name="msapplication-tooltip" content="Tooltip">
  <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">

  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
  <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
  <link rel="stylesheet" href="https://www.thethingsnetwork.org/docs/css/theme.min.1a1a30812d4274d8616380644cbf1670d6a3bc91fc7bd1d2c1d89177ea3d75f9.css" integrity="sha256-GhowgS1CdNhhY4BkTL8WcNajvJH8e9HSwdiRd&#43;o9dfk=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://www.thethingsnetwork.org/docs/ttui/main.min.85a20d88466627770856faf554e1bd1419b982f6a3a3fb90d51f4cb93425b7e8.css" integrity="sha256-haINiEZmJ3cIVvr1VOG9FBm5gvajo/uQ1R9MuTQlt&#43;g=" crossorigin="anonymous">

  <meta property="og:title" content="Migrate your Gateways and Devices" />
<meta property="og:description" content="We are building a global open free crowdsourced long range low power IoT data network" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/" /><meta property="og:image" content="https://www.thethingsnetwork.org/docs/img/og-image.png"/><meta property="og:site_name" content="The Things Network" />



  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.thethingsnetwork.org/docs/img/og-image.png"/>

<meta name="twitter:title" content="Migrate your Gateways and Devices"/>
<meta name="twitter:description" content="We are building a global open free crowdsourced long range low power IoT data network"/>


</head>


<body>

<ttn-header class="theme-ttn"></ttn-header><section class="section">
  <div class="container">
    <nav class="breadcrumb has-dot-separator" aria-label="breadcrumbs">
      <ul>
        
        
          <li><a href="https://www.thethingsnetwork.org/docs">Learn</a></li>
          
          
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
            
              
            
          
              <li class="">
                <a href="https://www.thethingsnetwork.org/docs/lorawan/">LoRaWAN®</a>
              </li>
            
          
              <li class="">
                <a href="https://www.thethingsnetwork.org/docs/quick-start/">Quick Start</a>
              </li>
            
          
              <li class="">
                <a href="https://www.thethingsnetwork.org/docs/applications-and-integrations/">Applications &amp; Integrations</a>
              </li>
            
          
              <li class="">
                <a href="https://www.thethingsnetwork.org/docs/devices-and-gateways/">Devices &amp; Gateways</a>
              </li>
            
          
              <li class="is-active">
                <a href="https://www.thethingsnetwork.org/docs/the-things-stack/">Migrating to The Things Stack Community Edition</a>
              </li>
            
          
              <li class="">
                <a href="https://www.thethingsnetwork.org/docs/v2-docs/">V2 Docs (Outdated)</a>
              </li>
            
          
        
      </ul>
    </nav>
    
  </div>
</section>
<div class="container" role="document">
  <div class="columns my-0 is-desktop">
    <div class="column is-3-desktop sidebar-left">
      


<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Migrating to The Things Stack Community Edition</h2>

<div class="menu">
  <ul class="menu-list">
  <a href="https://www.thethingsnetwork.org/docs/the-things-stack/" class="">Overview</a>
  <li>
      <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/" class="is-active">Migrate your Gateways and Devices</a>
      


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/migrate-using-console/" class="">Migrate End Devices using The Things Stack Community Edition Console</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/migrate-using-migration-tool/" class="">Migrate End Devices using the Migration Tool</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/migrate-gateways/" class="">Migrate Gateways</a>
    
  </li>

</ul>


      
    </li>
  <li>
      <a href="https://www.thethingsnetwork.org/docs/the-things-stack/faq/" class="">Frequently Asked Questions</a>
    </li>
  
  </ul>
</div>





</nav>

    </div>
    <div class="column is-9-desktop sidebar-middle">
      <div class="docs-content">
        <h1 class="title is-size-2">
          Migrate your Gateways and Devices
        </h1>
        <div class="content">
          
<p>This guide was written to explain the overall migration process of migrating from The Things Network V2 to The Things Stack Community Edition in a several easy-to-follow steps.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  Since version 3.13 of The Things Stack (released in May, 2021), The Things Network V2 routes traffic back and forth to The Things Stack Community Edition. When migrating your gateways to The Things Stack Community Edition, the coverage of the public community network will not be impacted.
</div>

<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  <p>The Things Stack Community Edition is a LoRaWAN Network Server which is free to use for The Things Network community members. The Community Edition is designed for testing and evaluating LoRaWAN projects and is managed by <a href="https://www.thethingsindustries.com/">The Things Industries</a>. The Community Edition comes without guarantees and only includes community support, hence is not suitable for commercial usage. Join The Things Network <a href="https://www.thethingsnetwork.org/forum/">Forum</a> or <a href="https://thethingsnetwork.slack.com/">Slack</a> for community support.</p>
<p>For commercial LoRaWAN projects, it is recommended to use an SLA-backed version of The Things Stack, as it includes professional support. <a href="https://www.thethingsindustries.com/deployment/">Click here to learn more.</a></p>

</div>

<p>Generally, the process of migrating from The Things Network V2 to The Things Stack Community Edition depends on few things:</p>
<ul>
<li>Type of devices you are using - ABP or OTAA</li>
<li>If you are able to migrate your gateway at the moment, or you want to use <a href="https://www.thethingsindustries.com/docs/reference/packet-broker/">Packet Broker</a> to route your traffic (and migrate your gateway later)</li>
<li>How many devices you wish to migrate, i.e. if you want to migrate them one by one or in bulk</li>
<li>If you wish to migrate your devices with or without an active session from V2</li>
</ul>
<p>Let us assume that your gateway and device are connected to The Things Network V2.</p>
<blockquote>
<p><a href="https://v2console.thethingsnetwork.org/">Link to The Things Network V2 Console</a></p>
</blockquote>
<p>In this section, we will first consider migrating your end device, then your gateway to The Things Stack Community Edition. Along the way, we will highlight differences between the aforementioned use cases and recommend some best practices. You will also need to add your applications, integrations and payload formatters in The Things Stack Community Edition.</p>
<blockquote>
<p><a href="https://www.thethingsindustries.com/deployment/">Link to The Things Stack Community Edition Console</a></p>
</blockquote>
<h4 id="video-migrate-from-the-things-network-v2-to-the-things-stack">Video Migrate from The Things Network V2 to The Things Stack&nbsp;<a class="header-hash" href="#video-migrate-from-the-things-network-v2-to-the-things-stack">#</a> </h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/DL87O5zNE_4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="log-in-to-the-things-stack-community-edition">Log in to The Things Stack Community Edition&nbsp;<a class="header-hash" href="#log-in-to-the-things-stack-community-edition">#</a> </h2>
<p>To be able to continue following steps below, you first need to log in to The Things Stack Community Edition Console by first <a href="https://console.cloud.thethings.network/">selecting a cluster</a> that is closest to you geographically. You can then log in with your The Things Network credentials via The Things ID.</p>
<h2 id="add-an-application-in-the-things-stack-community-edition">Add an application in The Things Stack Community Edition&nbsp;<a class="header-hash" href="#add-an-application-in-the-things-stack-community-edition">#</a> </h2>
<p>To migrate your end device, you first need to <a href="https://www.thethingsindustries.com/docs/integrations/adding-applications/">add an application</a> on the The Things Stack Community Edition. The <code>Application ID</code> does not neccessarily have to be the same as the one in The Things Network V2.</p>
<h2 id="add-your-payload-formatters-and-integrations">Add your payload formatters and integrations&nbsp;<a class="header-hash" href="#add-your-payload-formatters-and-integrations">#</a> </h2>
<p>After adding an application in The Things Stack Community Edition, you also need to re-add the associated elements, like payload formatters (known as coders and decoders in The Things Network V2) and integrations.</p>
<p>The format of The Things Network Stack V2
payload coders and decoders is still supported in The Things Stack. You can copy and paste function code used in The Things Network Stack V2
directly in The Things Stack.</p>
<p><img src="legacy-payload-formatter.png" alt="Legacy Payload Formatter"></p>
<p>The Things Stack also supports a new <code>decodeUplink</code> function which is described in <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/javascript/">The Things Stack Payload Formatter Documentation</a>.</p>
<p>While you can simply paste your <code>Decoder</code> function in The Things Stack and it will work, if you wish to take advantage of the additional <code>warnings</code> and <code>errors</code> fields in The Things Stack, you need to convert your <code>Decoder</code> function to a <code>decodeUplink</code> function.</p>
<p>The <code>decodeUplink</code> function receives an <code>input</code> object, and must return an object containing <code>data</code>.</p>
<p>For example, if your payload decoder function in The Things Network Stack V2
was:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Decoder</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">temperature</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>  
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">temperature</span><span class="o">:</span> <span class="nx">temperature</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>then your uplink payload formatter function in The Things Stack should be:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">decodeUplink</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">bytes</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">temperature</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">temperature</span><span class="o">:</span> <span class="nx">temperature</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>And to take advantage of the <code>warnings</code> and <code>errors</code> fields, you could do the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">decodeUplink</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">bytes</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">temperature</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">warnings</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">temperature</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">warnings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&#34;it&#39;s cold!&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">temperature</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">273</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&#34;out of bounds&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">temperature</span><span class="o">:</span> <span class="nx">temperature</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">warnings</span><span class="o">:</span> <span class="nx">warnings</span><span class="p">;</span>
      <span class="nx">errors</span><span class="o">:</span> <span class="nx">errors</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>See more info on how to <a href="https://www.thethingsindustries.com/docs/integrations/payload-formatters/">write payload formatters</a> and <a href="https://www.thethingsindustries.com/docs/integrations/adding-integrations/">add integrations</a> in The Things Stack Community Edition.</p>
<h2 id="ready-for-migration">Ready for Migration&nbsp;<a class="header-hash" href="#ready-for-migration">#</a> </h2>
<p>Next, you need to migrate your end device(s) to The Things Stack Community Edition.</p>
<div class="notification is-primary is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Info:</h5>
  This guide refers only to The Things Network V2 and The Things Stack Community Edition deployments. The full migration process that covers all V2 and The Things Stack deployments is described <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/">here</a>.
</div>

<p>Migrating end devices can be easily done using:</p>
<ul>
<li>The Things Stack Community Edition Console. See <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/migrate-using-console/">Migrate End Devices using The Things Stack Community Edition Console</a>.</li>
<li><code>ttn-lw-migrate</code> tool. See <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/migrate-using-migration-tool/">Migrate End Devices using the Migration Tool</a>.</li>
</ul>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  We highly recommend to test the migration on a single end device or a small batch of end devices first, just to make sure the migration process is succesful and that you are getting an expected result.
</div>

<p>Depending on your use case, you might want to:</p>
<ul>
<li>Keep your gateway connected to The Things Network V2 and route your traffic via Packet Broker to The Things Stack Community Edition - if this is the case, we recommend to read the <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/migrating-from-v2/packet-broker-requirements/">Packet Broker Requirements</a></li>
<li>Migrate your gateway to The Things Stack Community Edition - see <a href="https://www.thethingsnetwork.org/docs/the-things-stack/migrate-to-v3/migrate-gateways/">Migrate Gateways</a></li>
</ul>


        </div>
      
      




  
    
    
  

  


<div class="is-clearfix">
<a class="button is-pulled-right" href="/docs/the-things-stack/faq/">Frequently Asked Questions →</a>
</div>

      </div>
    </div>
  </div>
</div>


<div class="ttn-footer"><ttn-footer class="theme-ttn"></ttn-footer></div>

<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
<script src="https://www.thethingsnetwork.org/static/common/js/web-components/ttn-header.js"></script>
<script src="https://www.thethingsnetwork.org/static/common/js/web-components/ttn-footer.js"></script>
<script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
<script src="https://www.thethingsnetwork.org/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsnetwork.org/docs/js/theme.min.00ace5d667ca108a93b8a0d385569f7c7bb9f46ed32eefe3f5fb39105763cccd.js" integrity="sha256-AKzl1mfKEIqTuKDThVaffHu59G7TLu/j9fs5EFdjzM0=" crossorigin="anonymous"></script>

</body>

</html>
