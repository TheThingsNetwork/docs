<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/lorawan/security.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Security | The Things Network</title>
<meta name="generator" content="Jekyll v3.4.5" />
<meta property="og:title" content="Security" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="LoRaWAN Security" />
<meta property="og:description" content="LoRaWAN Security" />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/lorawan/security.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/lorawan/security.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-16T09:30:39+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="twitter:title" content="Security" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},"image":"https://www.thethingsnetwork.org/docs/assets/images/og-image.png","description":"LoRaWAN Security","headline":"Security","datePublished":"2020-11-16T09:30:39+00:00","dateModified":"2020-11-16T09:30:39+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thethingsnetwork.org/docs/lorawan/security.html"},"url":"https://www.thethingsnetwork.org/docs/lorawan/security.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Tooltip">
    <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="header"></div>
    <div id="content">
<div class="layout-page">
  <!-- <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="⛅ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div> -->
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class="active"><a href="/docs/lorawan/">LoRaWAN</a></li>
                <li class=""><a href="/docs/devices/">Devices</a></li>
                <li class=""><a href="/docs/gateways/">Gateways</a></li>
                <li class=""><a href="/docs/network/">Network</a></li>
                <li class=""><a href="/docs/applications/">Applications</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/docs/edit/master/_content/lorawan/security.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>security.md</strong></a>
      </div>
      <div class="col-12">
        This documentation page applies to the legacy Things Network Stack V2. Documentation for The Things Stack V3 is available <a href="https://thethingsstack.io">here</a>
      </div>
    </div>
    <div class="row wrapper">
      <div class="col-sm-3 side-nav">
        <div class="panel page-side-nav">
          <div class="panel-body">
            <ul>
              <li class=""><a href="/docs/lorawan/index.html"><h5>LoRaWAN</h5></a>
              </li>
            <li class="page-side-nav-section"><span>Fundamental</span>
            <ul>
                <li class=""><a href="/docs/lorawan/architecture.html">LoRaWAN Architecture</a>
                </li>
                <li class=""><a href="/docs/lorawan/regional-parameters.html">Regional Parameters</a>
                </li>
                <li class=""><a href="/docs/lorawan/limitations.html">Limitations</a>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Specifications</span>
            <ul>
                <li class=""><a href="/docs/lorawan/classes.html">Classes</a>
                </li>
                <li class=""><a href="/docs/lorawan/addressing.html">Addressing & Activation</a>
                </li>
                <li class=""><a href="/docs/lorawan/modulation-data-rate.html">Modulation & Data Rate</a>
                </li>
                <li class=""><a href="/docs/lorawan/adaptive-data-rate.html">Adaptive Data Rate</a>
                </li>
                <li class=""><a href="/docs/lorawan/duty-cycle.html">Duty Cycle</a>
                </li>
                <li class="active"><a href="/docs/lorawan/security.html">Security</a>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Additional Information</span>
            <ul>
                <li class=""><a href="/docs/lorawan/frequency-plans.html">Frequency Plans</a>
                </li>
                <li class=""><a href="/docs/lorawan/frequencies-by-country.html">Frequency Plans by Country</a>
                </li>
                <li class=""><a href="/docs/lorawan/prefix-assignments.html">NetID and DevAddr Prefix Assignments</a>
                </li>
            </ul>
            </li>
            </ul>
            <!-- <li class="hidden-xs col-sm-2 page-toc page-affix"></li> --> 
          </div>
        </div> 
      </div>
      <div class="col-sm-9 page-body">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="lorawan-security">LoRaWAN Security</h1>
<h2 id="security-keys">Security Keys</h2>
<p>LoRaWAN 1.0 specifies a number of security keys: <code class="highlighter-rouge">NwkSKey</code>, <code class="highlighter-rouge">AppSKey</code> and <code class="highlighter-rouge">AppKey</code>. All keys have a length of 128 bits.
The algorithm used for this is AES-128, similar to the algorithm used in the 802.15.4 standard.</p>
<h3 id="session-keys">Session Keys</h3>
<p>When a device joins the network (this is called a join or activation), an application session key <code class="highlighter-rouge">AppSKey</code> and a network session key <code class="highlighter-rouge">NwkSKey</code> are generated. The <code class="highlighter-rouge">NwkSKey</code> is shared with the network, while the <code class="highlighter-rouge">AppSKey</code> is kept private. These session keys will be used for the duration of the session.</p>
<p>The <strong>Network Session Key</strong> (<code class="highlighter-rouge">NwkSKey</code>) is used for interaction between the Node and the Network Server. This key is used to validate the integrity of each message by its Message Integrity Code (MIC check). This MIC is similar to a checksum, except that it prevents intentional tampering with a message. For this, LoRaWAN uses AES-CMAC. In the backend of The Things Network this validation is also used to map a non-unique device address (<code class="highlighter-rouge">DevAddr</code>) to a unique <code class="highlighter-rouge">DevEUI</code> and <code class="highlighter-rouge">AppEUI</code>.</p>
<p>The <strong>Application Session Key</strong> (<code class="highlighter-rouge">AppSKey</code>) is used for encryption and decryption of the payload. The payload is fully encrypted between the Node and the Handler/Application Server component of The Things Network (which you will be able to run on your own server). This means that nobody except you is able to read the contents of messages you send or receive.</p>
<p>These two session keys (<code class="highlighter-rouge">NwkSKey</code> and <code class="highlighter-rouge">AppSKey</code>) are unique per device, per session. If you dynamically activate your device (OTAA), these keys are re-generated on every activation. If you statically activate your device (ABP), these keys stay the same until you change them.</p>
<h3 id="application-key">Application Key</h3>
<p>The application key (<code class="highlighter-rouge">AppKey</code>) is only known by the device and by the application. Dynamically activated devices (OTAA) use the <strong>Application Key</strong> (<code class="highlighter-rouge">AppKey</code>) to derive the two session keys during the activation procedure. In The Things Network you can have a <em>default</em> <code class="highlighter-rouge">AppKey</code> which will be used to activate all devices, or customize the <code class="highlighter-rouge">AppKey</code> per device.</p>
<h2 id="frame-counters">Frame Counters</h2>
<p>Because we’re working with a radio protocol, anyone will be able to capture and store messages. It’s not possible to read these messages without the <code class="highlighter-rouge">AppSKey</code>, because they’re encrypted. Nor is it possible to tamper with them without the <code class="highlighter-rouge">NwkSKey</code>, because this will make the MIC check fail. It is however possible to re-transmit the messages. These so-called replay attacks can be detected and blocked using frame counters.</p>
<p>When a device is activated, these frame counters (<code class="highlighter-rouge">FCntUp</code> and <code class="highlighter-rouge">FCntDown</code>) are both set to <code class="highlighter-rouge">0</code>. Every time the device transmits an uplink message, the <code class="highlighter-rouge">FCntUp</code> is incremented and every time the network sends a downlink message, the <code class="highlighter-rouge">FCntDown</code> is incremented. If either the device or the network receives a message with a frame counter that is lower than the last one, the message is ignored.</p>
<p>This security measure has consequences for development devices, which often are statically activated (ABP). When you do this, you should realize that these frame counters reset to <code class="highlighter-rouge">0</code> every time the device restarts (when you flash the firmware or when you unplug it). As a result, The Things Network will block all messages from the device until the <code class="highlighter-rouge">FCntUp</code> becomes higher than the previous <code class="highlighter-rouge">FCntUp</code>. Therefore, you should re-register your device in the backend every time you reset it.</p>
<h2 id="spread-spectrum">Spread Spectrum</h2>
<p>Spread Spectrum Radio Transmission was traditionally used, during WW2, to make military communications difficult to monitor - either by using a technique called ‘frequency hopping’ (FHSS) - skipping the transmission frequency around in a prearranged manner, causing the enemy to constantly retune (very rapidly) or ‘direct sequence’ (DSSS) where the digital message is added to a much higher bit-rate, pseudo random (PR) sequence.  The code spreads the radio signal over a much wider bandwidth.  In fact, so wide that the power may well be dispersed so that the total signal falls down into the background radio noise - and becomes invisible.  Recovery is therefore a matter of i) knowing the original radio frequency ii) the pseudo random code and iii) and the PR code bit rate.  Knowing these details means that synchronising receivers is not as difficult as may at first appear.  The signal will just ‘pop up’ out of the noise when the correct values are achieved. (‘Processing Gain’)</p>
<p>The technique used in LoRa is ‘<a href="https://youtu.be/dxYY097QNs0">CHIRP</a>’: Compressed High Intensity Radar Pulse.  It is even more complex but simple with current technology. As the name may suggest, the background design requirement, it is not used to hide the radio signal but is employed because of other factors, not just processing gain but interference immunity, channel sharing and resistance to radio reflections (amongst others).  It is therefore employed as security against operating conditions not for surveillance resistance. (Hedy Lamarr was a co-inventor and holds a patent for FHSS).</p>
          </div>  
        </div>
        <div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ttn-components.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-navbar.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-footer.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
  </body>
</html>
