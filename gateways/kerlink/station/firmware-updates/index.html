<!DOCTYPE html>

<html lang="en-us" class="has-ttn-navbar-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <meta name="generator" content="Hugo 0.88.1" />

  <title>Firmware Updates | The Things Network</title>
  <link rel="canonical" href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/firmware-updates/" />
  

  <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">

  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">

  <meta name="application-name" content="The Things Network">
  <meta name="msapplication-tooltip" content="Tooltip">
  <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">

  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
  <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
  <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
  <link rel="stylesheet" href="https://www.thethingsnetwork.org/docs/css/theme.min.58fca61d6003439b384e4126a522c6391c0560a0cbd77a99c73d351bb2018920.css" integrity="sha256-WPymHWADQ5s4TkEmpSLGORwFYKDL13qZxz01G7IBiSA=" crossorigin="anonymous">

  <link rel="stylesheet" href="https://ttui.thethingsindustries.com/release/1.3.1/main.css" />

  <meta property="og:title" content="Firmware Updates" />
<meta property="og:description" content="We are building a global open free crowdsourced long range low power IoT data network" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/firmware-updates/" /><meta property="og:image" content="https://www.thethingsnetwork.org/docs/img/og-image.png"/><meta property="og:site_name" content="The Things Network" />



  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.thethingsnetwork.org/docs/img/og-image.png"/>

<meta name="twitter:title" content="Firmware Updates"/>
<meta name="twitter:description" content="We are building a global open free crowdsourced long range low power IoT data network"/>


</head>


<body>

<ttn-header class="theme-ttn" root-url="https://www.thethingsnetwork.org"></ttn-header><section class="section">
  <div class="container">
    <nav class="breadcrumb has-dot-separator" aria-label="breadcrumbs">
      <ul>
        
        
          <li><a href="https://www.thethingsnetwork.org/docs/v2-docs/">Go Back - V2 Docs (Outdated)</a></li>
        
        
            <li class="">
              <a href="https://www.thethingsnetwork.org/docs/devices/">Devices (V2)</a>
            </li>
          
        
            <li class="is-active">
              <a href="https://www.thethingsnetwork.org/docs/gateways/">Gateways (V2)</a>
            </li>
          
        
            <li class="">
              <a href="https://www.thethingsnetwork.org/docs/applications/">Applications (V2)</a>
            </li>
          
        
            <li class="">
              <a href="https://www.thethingsnetwork.org/docs/network/">Network (V2)</a>
            </li>
          
        
      
      </ul>
    </nav>
    
      <div class="notification is-warning is-light has-text-dark">
        <h5 class="title is-family-sans-serif has-text-dark mb-1">Warning:</h5>
        This section contains documentation written for The Things Network V2, which is no longer maintained. See <a href="https://thethingsindustries.com/docs">documentation for The Things Stack V3</a>.
      </div>
    
  </div>
</section>
<div class="container" role="document">
  <div class="columns my-0 is-desktop">
    <div class="column is-3-desktop sidebar-left">
      


<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Gateways</h2>

<div class="menu">
  <ul class="menu-list">
  <a href="https://www.thethingsnetwork.org/docs/gateways/" class="">Overview</a>
  <li>
      <a href="https://www.thethingsnetwork.org/docs/gateways/basics-station/" class="">LoRa Basics™ Station</a>
    </li>
  <li>
      <a href="https://www.thethingsnetwork.org/docs/gateways/certificates/" class="">Root Certificates</a>
    </li>
  
    <p class="menu-label">
      Running a gateway
    </p>
    
      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/troubleshooting/" class="">Troubleshooting</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/lightning-protection/" class="">Lightning Protection</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/packet-forwarder/" class="">Packet Forwarders</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/registration/" class="">Gateway Registration</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/start/" class="">Where to start</a>
</li>

  
    <p class="menu-label">
      Hardware
    </p>
    
      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/pisupply-hat/" class="">Pi Supply Gateway HAT</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/multitech/" class="">MultiTech Conduit</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/rak2245/" class="">RAK2245 Pi Hat Edition - LoRaWAN® Gateway Concentrator Module</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/rak7243c/" class="">RAK7243C Pilot Gateway</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/rak831/" class="">RAK831</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/gateway/" class="">The Things Gateway</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/thethingsindoor/" class="">The Things Indoor Gateway</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/thethingsoutdoor/" class="">The Things Outdoor Gateway</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/aaeon/" class="">AAEON</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/cisco/" class="">Cisco LoRaWAN Gateway</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/" class="">Kerlink</a>
  


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/reverse-ssh/" class="">Reverse SSH</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/keros/" class="">KerOS installation and configuration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/ibts/" class="">Wirnet iBTS</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/ifemtocell/" class="">Wirnet iFemtoCell</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/ifemtocell-evolution/" class="">Wirnet iFemtoCell Evolution</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/istation/" class="">Wirnet iStation</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/" class="">Wirnet Station</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/mount/" class="">Mount</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/cellular/" class="">Cellular Connection</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/firmware-updates/" class="is-active">Firmware Updates</a>
    
    



    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/config/" class="">Configuration</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/setup/" class="">Setup</a>
    
  </li>

  <li>
    <a href="https://www.thethingsnetwork.org/docs/gateways/kerlink/station/specs/" class="">Specifications</a>
    
  </li>

</ul>


    
  </li>

</ul>


  
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/laird/" class="">Laird RG1xx</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/lorrier/" class="">Lorrier LR2</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/mikrotik/" class="">MikroTik Routerboard</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/st/" class="">P-NUCLEO-LRWAN2</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/tektelic/" class="">Tektelic</a>
</li>

      
<li>
  <a href="https://www.thethingsnetwork.org/docs/gateways/ursalink/" class="">Ursalink</a>
</li>

  
  </ul>
</div>





</nav>

    </div>
    <div class="column is-9-desktop sidebar-middle">
      <div class="docs-content">
        <h1 class="title is-size-2">
          Firmware Updates
        </h1>
        <div class="content">
          
<p>Please read through this entire document before performing the firmware update. If the procedure is not done correctly you stand a chance to brick your gateway. A firmware upgrade will most likely result in a factory reset of the gateway.</p>
<h2 id="firmware-update-procedure-summary">Firmware update procedure summary&nbsp;<a class="header-hash" href="#firmware-update-procedure-summary">#</a> </h2>
<ul>
<li>Format a USB flash drive as FAT32.</li>
<li>Download produsb_wirnet_v3.6.zip from <a href="https://raw.githubusercontent.com/TheThingsNetwork/kerlink-station-firmware/master/dota/produsb_wirnet_v3.6.zip">here</a>.</li>
<li>Extract produsb_wirnet_v3.6.zip to the flash drive so that the produsb.sh and produsb_wirnet_v3.6.md5 files are the only two files on the flash drive.</li>
<li>Download usbflashdrive_wirmav2_wirnet_v3.6.zip from <a href="https://raw.githubusercontent.com/TheThingsNetwork/kerlink-station-firmware/master/dota/usbflashdrive_wirmav2_wirnet_v3.6.zip">here</a>.</li>
<li>Extract usbflashdrive_wirmav2_wirnet_v3.6.zip to the root of the flash drive so that the content of this zip file is extracted to the same level as where produsb.sh is located.</li>
<li>Safely remove the flash drive from your computer.</li>
<li>Your Kerlink gateway should already be switched on and booted up. The safest is to power up the gateway and to wait two minutes for it to fully boot up.</li>
<li>Plug the flash drive into the USB port on the Kerlink. If the flash drive has a light it will start blinking. The gateway will detect the firmware file on the flash drive and start installing it. If you press the Test button on the gateway you will see the MOD1 and MOD2 lights flashing. When they stop flashing the firmware update is completeted and you can remove the flash drive from the USB port.</li>
</ul>
<h2 id="about-the-firmware">About the firmware&nbsp;<a class="header-hash" href="#about-the-firmware">#</a> </h2>
<p>Kerlink Wirnet Station firmware updates are installed from a USB drive. This needs to be a USB 1.1 compatible device formatted as FAT32.
The firmware consists of two parts:</p>
<ul>
<li><strong>System Firmware</strong> (usually) from Kerlink
<ul>
<li>Installed in <code>/</code> partition</li>
</ul>
</li>
<li><strong>User Firmware</strong> from TTN/TTI/Partner
<ul>
<li>Installed in <code>/mnt/fsuser-1</code> partition</li>
<li>Includes &ldquo;global&rdquo; configuration</li>
</ul>
</li>
</ul>
<p>The update process is simple:</p>
<ul>
<li>Plug in the USB drive</li>
<li>Wait for 5 minutes</li>
<li>A log file is written back to USB drive (<code>produsb.log</code>)</li>
</ul>
<h2 id="system-firmware-v31-and-above">System Firmware (v3.1 and above)&nbsp;<a class="header-hash" href="#system-firmware-v31-and-above">#</a> </h2>
<blockquote>
<p>⚠️ WARNING: After installation of this firmware you will not be able to revert to v2.3.3 - an attempt will brick your gateway. Refer Kerlink Wiki.</p>
</blockquote>
<p>The Gateway is shipped with Kerlink&rsquo;s &ldquo;stock system firmware&rdquo;. A backup of this system firmware is kept for recovery purposes (on the rescue FS). The system firmware can be updated by putting the contents of <code>usbflashdrive_wirmav2_wirnet_v3.1.zip</code> on a USB drive. Firmware updates do not overwrite the backup, rescue FS can be updated with <code>fs_rescue</code> files (see Kerlink wiki).</p>
<p>Contents of USB drive:</p>
<ul>
<li><code>u-boot.bin</code> - the bootloader binary</li>
<li><code>initramfs.cpio.gz.uboot</code> - the initial RAM filesystem that handles updates and recovery</li>
<li><code>script_uboot.img</code> - bootloader scripts</li>
<li><code>produsb.sh</code> - this script is executed by the initramfs</li>
<li><code>uImage</code> - the Linux kernel</li>
<li><code>rootfs.tar.gz</code> - the root filesystem, will be extracted to <code>/</code> (<code>/dev/mtdblock5</code>)</li>
<li><code>userfs.tar</code> - the user filesystem, will be extracted to <code>/mnt/fsuser-1</code> (<code>/dev/mtdblock6</code>)</li>
</ul>
<h2 id="recovery-andor-factory-reset">Recovery and/or factory reset&nbsp;<a class="header-hash" href="#recovery-andor-factory-reset">#</a> </h2>
<p>A factory reset can be performed by doing a firmware upgrade using a USB flash drive. This will only work if the currently running firmware is working. If it does not work, try the next option.</p>
<p>The gateway automatically restores the &ldquo;stock system firmware&rdquo; from the rescue FS if it detects that it is unstable. The gateway is considered unstable if the u-boot <code>bootfail</code> variable is greater than <code>max_bootfail</code>. This <code>max_bootfail</code> is 20 by default. The <code>bootfail</code> variable is incremented on each boot and reset when the gateway successfully starts. Both <code>bootfail</code> and <code>max_bootfail</code> can be set with the <code>fw_setenv</code> tool (or with <code>setenv</code> and <code>saveenv</code> in the u-boot console). Forcing the recovery process can be done by pressing the reset button for at least <code>max_bootfail</code> times with intervals of 4-10 seconds. This does not overwrite the user filesystem <code>/mnt/fsuser-1</code> (<code>/dev/mtdblock6</code>).</p>
<p>If pressing the reset button multiple times does not reset the gateway, you can try using the Wirgrid device to log into the gateway&rsquo;s boot loader and perform a reset from there. See <a href="https://www.thethingsnetwork.org/forum/t/convert-actility-kerlink-gateway-to-ttn/24026">this forum topic</a>.</p>
<h2 id="user-firmware-and-system-firmware-customizations">User Firmware and System Firmware Customizations&nbsp;<a class="header-hash" href="#user-firmware-and-system-firmware-customizations">#</a> </h2>
<p>The Gateway is usually shipped without or with outdated user firmware. The user firmware can be updated with <code>dota_XXXX.tar.gz</code> and <code>custo_XXXX.tar.gz</code> files.</p>
<p>Contents of USB drive:</p>
<ul>
<li><code>produsb.sh</code> - the script that executes the update steps</li>
<li><code>dota_XXXX.tar.gz</code> - customizes/updates the <strong>user firmware</strong>. Example contents of a <code>dota_thethingsnetwork_XXX.tar.gz</code> file:
<ul>
<li><code>begin_dota.sh</code> - executed at the begin of the update</li>
<li><code>end_dota.sh</code> - executed at the end of the update</li>
<li><code>mnt/fsuser-1/thethingsnetwork/poly_pkt_fwd.sh</code> - script that wraps the packet forwarder (sometimes called <code>wrapper.sh</code>)</li>
<li><code>mnt/fsuser-1/thethingsnetwork/poly_pkt_fwd</code> - the packet forwarder binary</li>
<li><code>mnt/fsuser-1/thethingsnetwork/global_conf.json</code> - configuration file for the packet forwarder</li>
<li><code>mnt/fsuser-1/thethingsnetwork/manifest.xml</code> - description of the &ldquo;package&rdquo; including auto-start settings</li>
</ul>
</li>
<li><code>custo_XXXX.tar.gz</code> customizes/updates the <strong>system firmware</strong> (<strong>and</strong> the backup). Example contents of <code>custo_libloragw_4.1.3-klk3_wirnet.tar.gz</code>:
<ul>
<li><code>usr/local/bin/util_fpga_start</code> - Utility to start the FPGA that handles listen-before-talk (LBT)</li>
</ul>
</li>
</ul>
<p>After editing the contents of the <code>dota_XXXX.tar.gz</code> file, compress with <code>tar -cvzf dota_upgrade.tar.gz --owner root --group root mnt usr</code> (use <code>gtar</code> on macOS).</p>
<h2 id="usb-firmware-update-security">USB Firmware update security&nbsp;<a class="header-hash" href="#usb-firmware-update-security">#</a> </h2>
<ul>
<li>Set a password in <code>/etc/usbkey.txt</code> on the gateway</li>
<li>The same password must be in <code>usbkey.txt</code> on the USB drive</li>
</ul>
<h2 id="i-still-have-problems-or-i-am-still-unsure-about-the-firmware-update">I still have problems or I am still unsure about the firmware update&nbsp;<a class="header-hash" href="#i-still-have-problems-or-i-am-still-unsure-about-the-firmware-update">#</a> </h2>
<p>Have a look on the Kerlink Wiki: <a href="http://wikikerlink.fr/lora-station">http://wikikerlink.fr/lora-station</a></p>
<h2 id="resources">Resources&nbsp;<a class="header-hash" href="#resources">#</a> </h2>
<ul>
<li>v3.6 produsb:<br>
<a href="https://raw.githubusercontent.com/TheThingsNetwork/kerlink-station-firmware/legacy/dota/produsb_wirnet_v3.6.zip">produsb_wirnet_v3.6.zip</a></li>
<li>v3.6 firmware: <a href="https://raw.githubusercontent.com/TheThingsNetwork/kerlink-station-firmware/legacy/dota/usbflashdrive_wirmav2_wirnet_v3.6.zip">usbflashdrive_wirmav2_wirnet_v3.6.zip</a></li>
</ul>


        </div>
      
      




  

  


<div class="is-clearfix">
</div>

      </div>
    </div>
  </div>
</div>


<div class="ttn-footer ttui-container"><ttn-footer class="theme-ttn"></ttn-footer></div>

<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
<script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
<script src="https://www.thethingsnetwork.org/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsnetwork.org/docs/js/theme.min.31c19cd691195a35b02746b7261b28ca9036fe4a3eed7d3e849762eeab55450e.js" integrity="sha256-McGc1pEZWjWwJ0a3JhsoypA2/ko&#43;7X0&#43;hJdi7qtVRQ4=" crossorigin="anonymous"></script>

<ttui-cookie class="theme-ttn" id="cookie-banner"></ttui-cookie>

<script>
  var cookieBanner = document.getElementById("cookie-banner");
  window.addEventListener("ttuicookieaccept", cookieAccept, { capture: true, once: true } );
  var cookieAcceptKey = 'ttn-ca'
  var timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

  if (readCookieAccept() || !timezone.includes("Europe") ) {
      cookieBanner.setAttribute('accepted', true);
  }

  function readCookieAccept() {
      return localStorage.getItem(cookieAcceptKey)
  }

  function cookieAccept() {
      localStorage.setItem(cookieAcceptKey, true);
  }
</script>

</body>

</html>
