<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/gateways/cisco/setup.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Setup | The Things Network</title>
<meta name="generator" content="Jekyll v3.4.5" />
<meta property="og:title" content="Setup" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Setup" />
<meta property="og:description" content="Setup" />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/gateways/cisco/setup.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/gateways/cisco/setup.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-23T10:13:30+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"description":"Setup","url":"https://www.thethingsnetwork.org/docs/gateways/cisco/setup.html","headline":"Setup","dateModified":"2018-05-23T10:13:30+00:00","datePublished":"2018-05-23T10:13:30+00:00","@type":"BlogPosting","image":"https://www.thethingsnetwork.org/docs/assets/images/og-image.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thethingsnetwork.org/docs/gateways/cisco/setup.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Tooltip">
    <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="header"></div>
    <div id="content">
<div class="layout-page">
  <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="‚õÖ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div>
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class=""><a href="/docs/lorawan/">LoRaWAN</a></li>
                <li class=""><a href="/docs/devices/">Devices</a></li>
                <li class="active"><a href="/docs/gateways/">Gateways</a></li>
                <li class=""><a href="/docs/network/">Network</a></li>
                <li class=""><a href="/docs/applications/">Applications</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/docs/edit/master/_content/gateways/cisco/setup.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>setup.md</strong></a>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <div class="panel page-side-nav page-affix">
          <div class="panel-body">
            <h5>Gateways</h5>
            <ul>
              <li class=""><a href="/docs/gateways/index.html">Overview</a>
              </li>
            <li class="page-side-nav-section"><span>Running a gateway</span>
            <ul>
                <li class=""><a href="/docs/gateways/start/">Where to start</a>
                </li>
                <li class=""><a href="/docs/gateways/registration.html">Gateway Registration</a>
                </li>
                <li class=""><a href="/docs/gateways/packet-forwarder/">Packet Forwarders</a>
                </li>
                <li class=""><a href="/docs/gateways/lightning-protection.html">Lightning Protection</a>
                </li>
                <li class=""><a href="/docs/gateways/troubleshooting/">Troubleshooting</a>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Hardware</span>
            <ul>
                <li class=""><a href="/docs/gateways/gateway/">The Things Gateway</a>
                </li>
                <li class=""><a href="/docs/gateways/multitech/">MultiTech Conduit</a>
                </li>
                <li class=""><a href="/docs/gateways/rak831/">RAK831</a>
                </li>
                <li class=""><a href="/docs/gateways/aaeon/">AAEON</a>
                </li>
                <li class=""><a href="/docs/gateways/cisco/">Cisco LoRaWAN Gateway</a>
            <ul>
                <li class="active"><a href="/docs/gateways/cisco/setup.html">Setup</a>
                </li>
            </ul>
                </li>
                <li class=""><a href="/docs/gateways/kerlink/">Kerlink LoRa IoT Station</a>
                </li>
                <li class=""><a href="/docs/gateways/lorrier/">Lorrier LR2</a>
                </li>
            </ul>
            </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-sm-7">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="setup">Setup</h1>
<p>Before starting the gateway, you‚Äôll need to set it up. If you‚Äôve never used Cisco equipment before, we‚Äôre providing you with basic instructions to set up the gateway, and basic system and network configuration.</p>
<h2 id="gateway-setup">Gateway setup</h2>
<ul>
  <li>Attach the <strong>antennas</strong> that you have for the gateway. If you have 2 antennas, plug in the both of them.</li>
</ul>
<p><img src="antenna.jpg" alt="" /></p>
<ul>
  <li>Plug in the <strong>GPS antenna</strong> for the gateway.</li>
</ul>
<p><img src="gps.jpg" alt="" /></p>
<ul>
  <li>Plug in the <strong>Ethernet cable</strong> of the gateway to your own switch or point of entry.</li>
</ul>
<p><img src="ethernet.jpg" alt="" /></p>
<ul>
  <li>
    <p>Plug in the <strong>power cable</strong> for the gateway. The Cisco LoRaWAN gateway supports two power methods:</p>
    <ul>
      <li>
        <p>Using a 48 VDC adapter, to plug in the <em>Power</em> port ;</p>
      </li>
      <li>
        <p>Using Power over Ethernet if you have a PoE adapter. In that case, use the adapter on the Ethernet port of the gateway.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Finally, to access the Cisco console, you‚Äôll need a console cable from USB to RJ45. Plug the RJ45 end in the <em>Console</em> port of the gateway, and the USB port to your computer.</p>
  </li>
</ul>
<p>Your gateway is now up and running, and connected to your computer!</p>
<h2 id="configuration">Configuration</h2>
<h3 id="connect-to-the-cisco-gateway-console">Connect to the Cisco gateway console</h3>
<p>You now have a serial connection to the Cisco gateway‚Äôs console.</p>
<p>To open up a terminal, you have several approaches available:</p>
<ul>
  <li>
    <p>Either use specialized serial connection software, such as <a href="https://www.decisivetactics.com/products/serial/">Serial</a> for macOS.</p>
  </li>
  <li>
    <p>Either use your operating system‚Äôs native serial connection software. For example, on macOS and Linux, open a Terminal, and type the following commands:</p>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>  ls /dev/tty.usb<span class="k">*</span>
</code></pre>
    </div>
    <p>You‚Äôll see the list of available USB serial devices. Once you‚Äôve found the once matching the Cisco console, connect using the following command:</p>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>  screen &lt;device&gt; 115200 <span class="c"># e.g. screen /dev/tty.usbserial-AO001X6M 115200</span>
</code></pre>
    </div>
  </li>
</ul>
<h3 id="system-setup">System setup</h3>
<p>This part covers <strong>setting up basic system and network parameters</strong>: updating it, connecting it to a local network, setting up <code class="highlighter-rouge">ntp</code> and the GPS. If you have specific network constraints, check with your system or network administrator how to set up the system for your network.</p>
<p>You‚Äôll notice that the user shell is quite different from Unix-based shells. This shell is called <strong>standalone mode</strong>, and is meant for a basic usage of the gateway. In many cases, the standalone mode shell won‚Äôt let you input unexpected characters and entries. In any shell, you can use the <code class="highlighter-rouge">?</code> command to show the list of available commands.</p>
<p>First, type <code class="highlighter-rouge">root</code> to login as the privileged user, and enter <code class="highlighter-rouge">enable</code> to turn on privileged commands. To verify that privileged commands are enabled, check that the prompt is <code class="highlighter-rouge">Gateway#</code> and not <code class="highlighter-rouge">Gateway&gt;</code>.</p>
<h4 id="update">Update</h4>
<p>To update your Cisco gateway, you can download the latest <a href="https://software.cisco.com/download/home/286311296/type/286311234/release/2.0.30?imageguid=A74F81D27FD3C1DF311D59849D054C10468D338E">firmware update here</a> - at least version 2.0.30. You will need a Cisco account with the right permissions to download the update file. If your account does not have those permissions, get in touch with your Cisco representative or with Cisco support.</p>
<p>Once you‚Äôve retrieved the update file, you can update your gateway by several ways: USB, FTP or TFTP. We‚Äôll cover in this guide how to update over USB. You will need for this a USB stick formatted in FAT. The USB port of the Cisco IXM being tiny, you‚Äôll want to use the tiniest USB stick that you own.</p>
<ol>
  <li>
    <p>Copy the update <code class="highlighter-rouge">*.tar.gz</code> file as <code class="highlighter-rouge">cisco_update.tar.gz</code> file at the root of the USB stick.</p>
  </li>
  <li>
    <p>Plug the USB stick in the Cisco gateway.</p>
  </li>
  <li>
    <p>Execute the following commands:</p>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> usb <span class="nb">enable
 </span>archive download-sw firmware /normal /save-reload usb:cisco_update.tar.gz
</code></pre>
    </div>
  </li>
</ol>
<p>This will update your Cisco firmware. After the operation, you can verify the installed version with <code class="highlighter-rouge">show version</code>.</p>
<h4 id="network-setup">Network setup</h4>
<p>To configure your Cisco Gateway to your network, type the following commands:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>configure terminal <span class="c"># Enter global configuration mode</span>
interface FastEthernet 0/1 <span class="c"># Enter Ethernet configuration</span>
</code></pre>
</div>
<p>If your local network has a <strong>DHCP server</strong> attributing IPs:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ip address dhcp
</code></pre>
</div>
<p>Otherwise, if you know the <strong>static IP address</strong> of your gateway:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ip address &lt;ip-address&gt; &lt;subnet-mask&gt;
</code></pre>
</div>
<p>Next, type the following to save the network configuration of your gateway:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>description Ethernet <span class="c"># Replace "Ethernet" by any description you want</span>
<span class="nb">exit</span> <span class="c"># Exit Ethernet configuration</span>
<span class="nb">exit</span> <span class="c"># Exit global configuration mode</span>
copy running-config startup-config <span class="c"># Save the configuration</span>
</code></pre>
</div>
<p>You can test your Internet configuration with the <code class="highlighter-rouge">ping</code> command, for example:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ping ip 8.8.8.8 <span class="c"># Ping Google's DNS server</span>
</code></pre>
</div>
<p>To see more information about the gateway‚Äôs IP and the network, you can use <code class="highlighter-rouge">show interfaces FastEthernet 0/1</code>, <code class="highlighter-rouge">show ip interfaces FastEthernet 0/1</code> or <code class="highlighter-rouge">show ip route</code>.</p>
<h4 id="date-and-time">Date and time</h4>
<p>To configure your system‚Äôs date and time, you can use <code class="highlighter-rouge">ntp</code>:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>configure terminal <span class="c"># Enter global configuration mode</span>
ntp server address &lt;NTP server address&gt; <span class="c"># Configure ntp on an ntp address</span>
<span class="c"># OR</span>
ntp server ip &lt;NTP server IP&gt; <span class="c"># Configure ntp on an IP</span>

<span class="nb">exit</span> <span class="c"># Exit global configuration mode</span>
</code></pre>
</div>
<p>If you don‚Äôt have production-grade <code class="highlighter-rouge">ntp</code> servers available, you can use <a href="http://www.pool.ntp.org/en/use.html"><code class="highlighter-rouge">pool.ntp.org</code></a>‚Äôs servers.</p>
<h4 id="fpga">FPGA</h4>
<p>If you needed to update your gateway firmware previously, your FPGA will need ~20 minutes to update once the new firmware is installed. The packet forwarder will not work until then, so we recommend at this point waiting until the FPGA is upgraded.</p>
<p>To show the status of the FPGA, you can use the following command:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>show inventory
</code></pre>
</div>
<p>When the <code class="highlighter-rouge">FPGAStatus</code> line indicates <code class="highlighter-rouge">Ready</code>, this means you can go forward with this guide.</p>
<h4 id="gps">GPS</h4>
<p>If you have a GPS connected to your Cisco gateway, enable it with the following commands:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>configure terminal <span class="c"># Enter global configuration mode</span>
gps ubx <span class="nb">enable</span> <span class="c"># Enable GPS</span>
<span class="nb">exit</span> <span class="c"># Exit global configuration mode</span>
</code></pre>
</div>
<h4 id="enable-radio">Enable radio</h4>
<p>As a final step before setting up the packet forwarder software, we‚Äôre going to <strong>enable the radio</strong>. You can see radio information with the <code class="highlighter-rouge">show radio</code> command:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>Gateway#show radio 
LORA_SN: FOC21028R8S
LORA_PN: 95.1602T01
LORA_SKU: 915
LORA_CALC: &lt;NA,NA,NA,50,31,106,97,88,80,71,63,53,44,34,25,16-NA,NA,NA,54,36,109,100,91,83,74,66,57,48,39,30,21&gt;
CAL_TEMP_CELSIUS: 31
CAL_TEMP_CODE_AD9361: 87
RSSI_OFFSET: -204.00,-204.40
LORA_REVISION_NUM: C0
RSSI_OFFSET_AUS: -203.00,-204.00

radio status: 
on
</code></pre>
</div>
<p>If the radio is off, enable with it <code class="highlighter-rouge">no radio off</code>.</p>
<blockquote>
  <p>üìú The <code class="highlighter-rouge">show radio</code> command also shows you more information about the LoRa concentrator powering the gateway. For example, <code class="highlighter-rouge">LORA_SKU</code> indicates the base frequency of the concentrator.</p>
</blockquote>
<h3 id="enable-authentication">Enable authentication</h3>
<p>To prevent unauthorized access to the gateway, you‚Äôll want to set up user authentication. The Cisco gateway has a <strong>secret</strong> system, that requires users to enter a secret to access privileged commands.</p>
<p>To enable this secret system, you can use the following commands:</p>
<ul>
  <li><code class="highlighter-rouge">configure terminal</code> to enter global configuration mode.</li>
  <li>To set the secret, you can use different commands:
    <ul>
      <li><code class="highlighter-rouge">enable secret &lt;secret&gt;</code> to enter in plaintext the secret you wish to set, instead of <code class="highlighter-rouge">&lt;secret&gt;</code>. <em>Note</em>: Special characters cannot be used in plain secrets.</li>
      <li><code class="highlighter-rouge">enable secret 5 &lt;secret&gt;</code> to enter the secret <strong>md5-encrypted</strong>, instead of <code class="highlighter-rouge">&lt;secret&gt;</code>.</li>
      <li><code class="highlighter-rouge">enable secret 8 &lt;secret&gt;</code> to enter the secret <strong>SHA512-encrypted</strong>, instead of <code class="highlighter-rouge">&lt;secret&gt;</code>.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">exit</code> to exit global configuration mode.</li>
  <li><code class="highlighter-rouge">copy running-config startup-config</code> to save the configuration.</li>
</ul>
<h3 id="verifications">Verifications</h3>
<p>Before we install the packet forwarder, let‚Äôs run verifications to ensure that the gateway is ready.</p>
<ul>
  <li>Type <code class="highlighter-rouge">show radio</code> to verify that the <strong>radio is enabled</strong>. The result should indicate <code class="highlighter-rouge">radio status: on</code>.</li>
  <li>Type <code class="highlighter-rouge">show inventory</code> to verify that the <strong><code class="highlighter-rouge">FPGAStatus</code> is <code class="highlighter-rouge">Ready</code></strong>.</li>
  <li>Type <code class="highlighter-rouge">show gps status</code> to verify that the <strong>GPS is correctly connected</strong>. You can get additional GPS metadata by typing <code class="highlighter-rouge">show gps info</code>.</li>
  <li>Verify that the <strong>network connection is working</strong>. You can test this by pinging common ping servers with <code class="highlighter-rouge">ping ip &lt;IP&gt;</code>, if your local network does not block ping commands. For example, you can ping Google‚Äôs servers with <code class="highlighter-rouge">ping ip 8.8.8.8</code>.</li>
</ul>
<p>If some of those checks fail, go back to the appropriate section earlier in order to fix it.</p>
<h2 id="installing-the-packet-forwarder">Installing the packet forwarder</h2>
<blockquote>
  <p>‚ö†Ô∏è Keep in mind that the pre-installed packet forwarder is not supported by Cisco for production purposes.</p>
</blockquote>
<p>To run the packet forwarder, we‚Äôll make use of the <strong>container</strong> that is running on the gateway at all times.</p>
<h3 id="packet-forwarder-configuration">Packet forwarder configuration</h3>
<p>When in standalone mode, enter the container:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>request shell container-console
</code></pre>
</div>
<p>Move to the directory where the packet forwarder configuration is located, and show the list of available frequency plans:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd</span> /etc/pktfwd
ls -la
</code></pre>
</div>
<p>Depending on your frequency plan, or on your specific setup, you‚Äôll want to use the most appropriate frequency plan. Once you‚Äôve decided on a frequency plan, set it as your current configuration:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mv config.json config_old.json
mv &lt;your config&gt; config.json
</code></pre>
</div>
<p>We‚Äôre now going to modify the configuration to point the packet forwarder to The Things Network. Select the <a href="../packet-forwarder/semtech-udp.html#router-addresses">router address</a> the most appropriate for your location.</p>
<p>Edit the configuration using a text editor, such as <code class="highlighter-rouge">vi</code>:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>vi config.json
</code></pre>
</div>
<p>You‚Äôll need to change the following settings:</p>
<ul>
  <li>
    <p><code class="highlighter-rouge">server_address</code> to <strong>the router address</strong> (such as <code class="highlighter-rouge">router.eu.thethings.network</code>)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">serv_port_up</code> and <code class="highlighter-rouge">serv_port_down</code> to <code class="highlighter-rouge">1700</code></p>
  </li>
</ul>
<p>Write down the value written for <code class="highlighter-rouge">gateway_ID</code>. Save the file, and exit your text editor.</p>
<h3 id="gateway-registration">Gateway registration</h3>
<p>Don‚Äôt close the shell yet, but open a Web browser and head to your the Things Network console. Click on <strong>Gateways</strong> &gt; <strong>Register gateway</strong>. Check the <em>I‚Äôm using legacy packet forwarder</em> box, and enter the gateway EUI that was indicated as <code class="highlighter-rouge">gateway_ID</code> in the configuration. Fill in the rest of the form, and click on <strong>Register gateway</strong>.</p>
<blockquote>
  <p>‚ö†Ô∏è If the gateway EUI is already marked as used, you‚Äôll need to change the <code class="highlighter-rouge">gateway_ID</code> value in the configuration of the gateway. The value must be an 8 bytes hexadecimal value.</p>
</blockquote>
<h3 id="testing-the-packet-forwarder">Testing the packet forwarder</h3>
<p>You can now test the packet forwarder by executing:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>pktfwd -c config.json -g/dev/ttyS1
</code></pre>
</div>
<p>You should now see packets flowing in the logs of the packet forwarder - and see gateway activity on the gateway‚Äôs package on the console!</p>
<blockquote>
  <p>Having issues making the packet forwarder run? Head over to our <a href="../troubleshooting/semtech-udp.html">packet forwarder troubleshooting section</a>.</p>
</blockquote>
<h3 id="installing-the-packet-forwarder-1">Installing the packet forwarder</h3>
<p>Now that we know the packet forwarder is running, let‚Äôs make it run permanently.</p>
<p>Save the following script as <code class="highlighter-rouge">/etc/init.d/S90_pkt_forwarder.sh</code>:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="nv">SCRIPT_DIR</span><span class="o">=</span>/etc/pktfwd
<span class="nv">SCRIPT</span><span class="o">=</span>pkt_forwarder
<span class="nv">RUNAS</span><span class="o">=</span>root

<span class="nv">PIDFILE</span><span class="o">=</span><span class="nv">$SCRIPT_DIR</span>/pkt_forwarder.pid

start<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> -f /var/run/<span class="nv">$PIDNAME</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">kill</span> -0 <span class="k">$(</span>cat /var/run/<span class="nv">$PIDNAME</span><span class="k">)</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="s1">'Service already running'</span> &gt;&amp;2
    <span class="k">return </span>1
  <span class="k">fi
  </span><span class="nb">echo</span> <span class="s1">'Starting service‚Ä¶'</span> &gt;&amp;2
  <span class="nb">cd</span> <span class="nv">$SCRIPT_DIR</span>
  start-stop-daemon -S -q -b -p <span class="s2">"</span><span class="nv">$PIDFILE</span><span class="s2">"</span> --exec <span class="s2">"</span><span class="nv">$SCRIPT</span><span class="s2">"</span> -- -c config.json -g/dev/ttyS1
  <span class="nb">echo</span> <span class="s1">'Service started'</span> &gt;&amp;2
<span class="o">}</span>

stop<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">"</span><span class="nv">$PIDFILE</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> ! <span class="nb">kill</span> -0 <span class="k">$(</span>cat <span class="s2">"</span><span class="nv">$PIDFILE</span><span class="s2">"</span><span class="k">)</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="s1">'Service not running'</span> &gt;&amp;2
    <span class="k">return </span>1
  <span class="k">fi
  </span><span class="nb">echo</span> <span class="s1">'Stopping service‚Ä¶'</span> &gt;&amp;2
  <span class="nb">kill</span> -15 <span class="k">$(</span>cat <span class="s2">"</span><span class="nv">$PIDFILE</span><span class="s2">"</span><span class="k">)</span> <span class="o">&amp;&amp;</span> rm -f <span class="s2">"</span><span class="nv">$PIDFILE</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s1">'Service stopped'</span> &gt;&amp;2
<span class="o">}</span>

uninstall<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> -n <span class="s2">"Are you really sure you want to uninstall this service? That cannot be undone. [yes|No] "</span>
  <span class="nb">local </span>SURE
  <span class="nb">read </span>SURE
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$SURE</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"yes"</span> <span class="o">]</span>; <span class="k">then
    </span>stop
    rm -f <span class="s2">"</span><span class="nv">$PIDFILE</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"Notice: log file is not be removed: '</span><span class="nv">$LOGFILE</span><span class="s2">'"</span> &gt;&amp;2
    update-rc.d -f &lt;NAME&gt; remove
    rm -fv <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
  </span>start<span class="p">)</span>
    start
    <span class="p">;;</span>
  stop<span class="p">)</span>
    stop
    <span class="p">;;</span>
  uninstall<span class="p">)</span>
    uninstall
    <span class="p">;;</span>
  restart<span class="p">)</span>
    stop
    start
    <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {start|stop|restart|uninstall}"</span>
<span class="k">esac</span>
</code></pre>
</div>
<p>This script will be called at every startup of the container. To enable it immediately, execute <code class="highlighter-rouge">./S90_pkt_forwarder.sh start</code>.</p>
<h3 id="exit-container-shell">Exit container shell</h3>
<p>If you are done with configuration, you can now safely remove the serial cable between your computer.</p>
          </div>
        </div>
      </div>
      <div class="hidden-xs col-sm-2">
        <div class="page-toc page-affix"></div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ttn-components.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-navbar.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-footer.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
  </body>
</html>
