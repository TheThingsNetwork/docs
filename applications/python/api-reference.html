<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/applications/python/api-reference.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>API Reference | The Things Network</title>
<meta name="generator" content="Jekyll v3.4.5" />
<meta property="og:title" content="API Reference" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="API Reference" />
<meta property="og:description" content="API Reference" />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/applications/python/api-reference.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/applications/python/api-reference.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-11-12T08:54:05+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="twitter:title" content="API Reference" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"description":"API Reference","@type":"BlogPosting","headline":"API Reference","dateModified":"2019-11-12T08:54:05+00:00","datePublished":"2019-11-12T08:54:05+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},"url":"https://www.thethingsnetwork.org/docs/applications/python/api-reference.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thethingsnetwork.org/docs/applications/python/api-reference.html"},"image":"https://www.thethingsnetwork.org/docs/assets/images/og-image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Tooltip">
    <meta name="msapplication-config" content="https://ttnweb.azureedge.net/static/common/favicon/ieconfig.54334a5ee30c.xml">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-32.61b30f85680a.png" sizes="32x32">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-57.83b86c64dc82.png" sizes="57x57">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-76.7dcf8fa36dfc.png" sizes="76x76">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-96.27ac17adaa8b.png" sizes="96x96">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-120.e1526731335e.png" sizes="120x120">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-128.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-144.61bd01a950fb.png" sizes="144x144">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-152.6c70a98e264d.png" sizes="152x152">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-180.fcd414307ca3.png" sizes="180x180">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-195.c55ce09d66da.png" sizes="195x195">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-228.bea53ec4b10b.png" sizes="228x228">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/smalltile.fabea041224c.png" sizes="128x128">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/mediumtile.3d42f7faac82.png" sizes="270x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/widetile.3d42f7faac82.png" sizes="558x270">
    <link rel="icon" href="https://ttnweb.azureedge.net/static/common/favicon/largetile.eb144ebab4d1.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnweb.azureedge.net/static/common/favicon/favicon-196.277278d69ddc.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="header"></div>
    <div id="content">
<div class="layout-page">
  <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="⛅ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div>
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class=""><a href="/docs/lorawan/">LoRaWAN</a></li>
                <li class=""><a href="/docs/devices/">Devices</a></li>
                <li class=""><a href="/docs/gateways/">Gateways</a></li>
                <li class=""><a href="/docs/network/">Network</a></li>
                <li class="active"><a href="/docs/applications/">Applications</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/docs/edit/master/_content/applications/python/api-reference.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>api-reference.md</strong></a>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <div class="panel page-side-nav page-affix">
          <div class="panel-body">
            <ul>
              <li class=""><a href="/docs/applications/index.html"><h5>Applications</h5></a>
            <ul>
                <li class=""><a href="/docs/applications/add.html">Add an Application</a>
                </li>
                <li class=""><a href="/docs/applications/options.html">Build an Application</a>
                </li>
            </ul>
              </li>
            <li class="page-side-nav-section"><span>APIs</span>
            <ul>
                <li class=""><a href="/docs/applications/apis.html">Overview</a>
                </li>
                <li class=""><a href="/docs/applications/manager/">Application Manager API</a>
                </li>
                <li class=""><a href="/docs/applications/mqtt/">Data API (MQTT)</a>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>SDKs & Libraries</span>
            <ul>
                <li class=""><a href="/docs/applications/sdks.html">Overview</a>
                </li>
                <li class=""><a href="/docs/applications/golang/">Go</a>
                </li>
                <li class=""><a href="/docs/applications/java/">Java</a>
                </li>
                <li class=""><a href="/docs/applications/nodered/">Node-RED</a>
                </li>
                <li class=""><a href="/docs/applications/nodejs/">Node.js</a>
                </li>
                <li class=""><a href="/docs/applications/python/">Python</a>
            <ul>
                <li class="active"><a href="/docs/applications/python/api-reference.html">API Reference</a>
                </li>
            </ul>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Integrations</span>
            <ul>
                <li class=""><a href="/docs/applications/integrations.html">Overview</a>
                </li>
                <li class=""><a href="/docs/applications/aws/">AWS IoT</a>
                </li>
                <li class=""><a href="/docs/applications/att/">AllThingsTalk</a>
                </li>
                <li class=""><a href="/docs/applications/cayenne/">Cayenne</a>
                </li>
                <li class=""><a href="/docs/applications/collos/">Collos</a>
                </li>
                <li class=""><a href="/docs/applications/http/">HTTP</a>
                </li>
                <li class=""><a href="/docs/applications/opensensors/">OpenSensors</a>
                </li>
                <li class=""><a href="/docs/applications/storage/">Storage</a>
                </li>
                <li class=""><a href="/docs/applications/ttnmapper/">TTN Mapper</a>
                </li>
                <li class=""><a href="/docs/applications/tago/">Tago</a>
                </li>
                <li class=""><a href="/docs/applications/thingspeak/">ThingSpeak</a>
                </li>
                <li class=""><a href="/docs/applications/evrythng/">EVRYTHNG</a>
                </li>
            </ul>
            </li>
            </ul>
            <!-- <li class="hidden-xs col-sm-2 page-toc page-affix"></li> --> 
          </div>
        </div> 
      </div>
      <div class="col-sm-7">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="api-reference">API Reference</h1>
<p>This package provides you an easy way to exchange traffic with The Things Network via MQTT and manage your applications.</p>
<h2 id="mqttclient">MQTTClient</h2>
<p>The class constructor can be called following this scheme:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">MQTTClient</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">access_key</span><span class="p">,</span> <span class="n">mqtt_address</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">discovery_address</span><span class="o">=</span><span class="s">"discovery.thethings.network:1900"</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li>
    <p><code class="highlighter-rouge">app_id</code>: <strong>string</strong> this the name given to the application when it was created.
<img src="1-app-console.png" alt="Screenshot of the console with app section" /></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">access_key</code>: <strong>string</strong> this can be found at the bottom of the application page under <strong>ACCESS KEYS</strong>.
<img src="2-accesskey-console.png" alt="Screenshot of the console with accesskey section" /></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">mqtt_address</code>: <strong>string</strong> this is the address of the handler to which the application was registered, in the <code class="highlighter-rouge"><span class="p">{</span><span class="err">hostname</span><span class="p">}</span><span class="err">:</span><span class="p">{</span><span class="err">port</span><span class="p">}</span></code> format.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">discovery_address</code>: <strong>string</strong> this is the address of the discovery server to use in order to find back the address of the MQTT handler, in the <code class="highlighter-rouge"><span class="p">{</span><span class="err">hostname</span><span class="p">}</span><span class="err">:</span><span class="p">{</span><span class="err">port</span><span class="p">}</span></code> format.</p>
    <p>If the <code class="highlighter-rouge">mqtt_address</code> is set, the <code class="highlighter-rouge">discovery_address</code> doesn’t need to be set as it is only used to retrieve the <code class="highlighter-rouge">mqtt_address</code> from the discovery server.
  The constructor returns an <strong>MQTTClient object</strong> set up with the application informations, ready to be connected to The Things Network.</p>
  </li>
</ul>
<h3 id="connect">connect</h3>
<p>Connects and starts the client in the background. This function also re-establishes the client’s connection in case it was closed.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre>
</div>
<h3 id="close">close</h3>
<p>Disconnects and stops the client from which the method is called.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
</div>
<h3 id="using-callbacks">Using Callbacks</h3>
<p>The callback functions are functions which are executed when a trigger event happens.</p>
<h4 id="set_uplink_callback">set_uplink_callback</h4>
<p>Add a callback function, to be called when an uplink message is received.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">set_uplink_callback</span><span class="p">(</span><span class="n">uplink_callback</span><span class="p">)</span>
</code></pre>
</div>
<h5 id="uplink_callback">uplink_callback</h5>
<p>The callback function must be declared in the script following this structure:</p>
<ul>
  <li><code class="highlighter-rouge">uplink_callback(msg, client)</code>
    <ul>
      <li><code class="highlighter-rouge">msg</code>: <strong>UplinkMessage object</strong> the message received by the client.</li>
      <li><code class="highlighter-rouge">client</code>: <strong>MQTTClient object</strong> the client from which the callback is executed.</li>
    </ul>
  </li>
</ul>
<h4 id="set_connect_callback">set_connect_callback</h4>
<p>Add a connection callback function to be executed when the client connects to the broker.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">set_connect_callback</span><span class="p">(</span><span class="n">connect_callback</span><span class="p">)</span>
</code></pre>
</div>
<h5 id="connect_callback">connect_callback</h5>
<ul>
  <li><code class="highlighter-rouge">connect_callback(res, client)</code>: the function which will be executed on connection to the broker.
    <ul>
      <li><code class="highlighter-rouge">res</code>: <strong>boolean</strong> the result of the connection. If it’s true, the connection succeeded. If not, it means the connection failed.</li>
      <li><code class="highlighter-rouge">client</code>: <strong>MQTTClient object</strong> the TTN client from which the callback is called.</li>
    </ul>
  </li>
</ul>
<h4 id="set_downlink_callback">set_downlink_callback</h4>
<p>Add a downlink callback function, with actions to execute when a downlink message is sent.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">set_downlink_callback</span><span class="p">(</span><span class="n">downlinkCallback</span><span class="p">)</span>
</code></pre>
</div>
<h5 id="downlink_callback">downlink_callback</h5>
<ul>
  <li><code class="highlighter-rouge">downlink_callback(mid, client)</code>: the function which will be a new publish behavior for our MQTT client.
    <ul>
      <li><code class="highlighter-rouge">mid</code>: <strong>int</strong> this is the message ID for the downlink request. It can be used to track the request.</li>
      <li><code class="highlighter-rouge">client</code>: <strong>MQTTClient object</strong> the TTN client from which the callback is called.</li>
    </ul>
  </li>
</ul>
<h4 id="set_close_callback">set_close_callback</h4>
<p>Add a callback to be executed when the connection to the TTN broker is closed.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">set_close_callback</span><span class="p">(</span><span class="n">close_callback</span><span class="p">)</span>
</code></pre>
</div>
<h5 id="close_callback">close_callback</h5>
<ul>
  <li><code class="highlighter-rouge">close_callback(res, client)</code>: the function which will be executed when the connection is closed.
    <ul>
      <li><code class="highlighter-rouge">res</code>: <strong>boolean</strong> the result of the disconnection. If it’s true, it went all as expected. If not, it means the disconnection was unexpected.</li>
      <li><code class="highlighter-rouge">client</code>: <strong>MQTTClient object</strong> the TTN client from which we call the callback.</li>
    </ul>
  </li>
</ul>
<h3 id="send">send</h3>
<p>Sends a downlink to the device.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">dev_id</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">confirmation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">schedule</span><span class="o">=</span><span class="s">"replace"</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">dev_id</code>: <strong>string</strong> the ID of the device which will receive the message.</li>
  <li><code class="highlighter-rouge">payload</code>: the payload of the message to be published to the broker. It can be an hexadecimal <strong>string</strong>, a base64 <strong>string</strong> like <code class="highlighter-rouge">AQ==</code> (this will send the raw payload <code class="highlighter-rouge">01</code> to your device) or a <strong>dictionary</strong> of JSON nature. Here is an example of a <strong>dictionary</strong> argument that could be passed to the method:</li>
</ul>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nt">"led_state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"on"</span><span class="p">,</span><span class="w"> </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>In case it’s a <strong>dictionary</strong> with fields, please make sure the <strong>encoder</strong> function (Payload Formats section) of the application is set to make sense of the informations transmitted in each field.
<img src="3-encoder-function.png" alt="Screenshot of an encoder function in the console" /></p>
<ul>
  <li><code class="highlighter-rouge">port</code>: <strong>int</strong> the port of the device to which the message will be sent.</li>
  <li><code class="highlighter-rouge">confirmation</code>: <strong>boolean</strong> this boolean indicates if you wish to receive a confirmation after sending the downlink message.</li>
  <li><code class="highlighter-rouge">schedule</code>: <strong>string</strong> this string provides the type of schedule on which the message should be sent. It can take the following values: <code class="highlighter-rouge">first</code>, <code class="highlighter-rouge">last</code>, <code class="highlighter-rouge">replace</code>.</li>
</ul>
<h3 id="uplinkmessage">UplinkMessage</h3>
<p>This type of object is constructed dynamically from the message received by the client, so this means some attributes can change from one message to another. Here are some constant attributes usually found in UplinkMessage objects:</p>
<ul>
  <li><code class="highlighter-rouge">app_id</code>: the application ID to which the device is registered</li>
  <li><code class="highlighter-rouge">dev_id</code>: the ID of the device</li>
  <li><code class="highlighter-rouge">port</code>: the port number on which the message was sent</li>
  <li><code class="highlighter-rouge">payload_raw</code>: a buffer which contains the payload in hexadecimal</li>
  <li><code class="highlighter-rouge">metadata</code>: this field is another object which contains all the metadata of the message. Such as: the date, the frequency, the data rate and the list of gateways.</li>
</ul>
<h2 id="applicationclient">ApplicationClient</h2>
<p>The class constructor can be called following this scheme:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ApplicationClient</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">access_key</span><span class="p">,</span> <span class="n">handler_address</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">cert_content</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">discovery_address</span><span class="o">=</span><span class="s">"discovery.thethings.network:1900"</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">app_id</code>: <strong>string</strong> this the name given to the application when it was created.
<img src="4-app-console.png" alt="Screenshot of the console with app section" /></li>
  <li><code class="highlighter-rouge">access_key</code>: <strong>string</strong> this can be found at the bottom of the application page under <strong>ACCESS KEYS</strong>. You will need a key allowing you to change the settings if you wish to update your application.</li>
  <li><code class="highlighter-rouge">handler_address</code>: <strong>string</strong> this is the address of the handler to which the application was registered, in the <code class="highlighter-rouge"><span class="p">{</span><span class="err">hostname</span><span class="p">}</span><span class="err">:</span><span class="p">{</span><span class="err">port</span><span class="p">}</span></code> format. Example: <code class="highlighter-rouge">handler.eu.thethings.network:1904</code>.</li>
  <li><code class="highlighter-rouge">cert_content</code>: <strong>string</strong> this is the content of the certificate used to connect in a secure way to the handler. Here is a certificate example:</li>
</ul>
<div class="highlighter-rouge"><pre class="highlight"><code>-----BEGIN CERTIFICATE-----
MIIBmjCCAUCgAwIBAgIRANKKhUVFRXhyx0gCX2h7EFwwCgYIKoZIzj0EAwIwHTEb
MBkGA1UEChMSVGhlIFRoaW5ncyBOZXR3b3JrMB4XDTE3MDgwMTA4MzQxMloXDTE4
MDgwMTA4MzQxMlowHTEbMBkGA1UEChMSVGhlIFRoaW5ncyBOZXR3b3JrMFkwEwYH
KoZIzj0CAQYIKoZIzj0DAQcDQgAEiXbWvyYjOMP4ebTYtVvdIsBwS+U3laWltR7V
ox4+kQWcGLLEg+suI9SRZyKK+frhw9JPKbVNIgEv/S50YKfMEaNhMF8wDgYDVR0P
AQH/BAQDAgKkMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAPBgNVHRMB
Af8EBTADAQH/MB0GA1UdEQQWMBSCB2hhbmRsZXKCCWxvY2FsaG9zdDAKBggqhkjO
PQQDAgNIADBFAiEA+vajlz7HDZ7x6KKi/uMlrwCePEcchZRYJPc/6kPyYogCIFSy
etQ54MyIOWtwYlxG+blnxT4PWCgas5rPiaK6VP/Z
-----END CERTIFICATE-----
</code></pre>
</div>
<ul>
  <li>
    <p><code class="highlighter-rouge">discovery_address</code>: <strong>string</strong> this is the address of the discovery server to use in order to find back the address of the handler to which the application in registered, in the <code class="highlighter-rouge"><span class="p">{</span><span class="err">hostname</span><span class="p">}</span><span class="err">:</span><span class="p">{</span><span class="err">port</span><span class="p">}</span></code> format. Example: <code class="highlighter-rouge">discovery.thethings.network:1900</code>.</p>
    <p>The constructor returns an <strong>ApplicationClient</strong> object set up with the application informations, ready to get the application registered on The Things Network.</p>
  </li>
</ul>
<h3 id="get">get</h3>
<p>Gives back the <a href="#application"><strong>Application</strong></a>.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre>
</div>
<h3 id="set_payload_format">set_payload_format</h3>
<p>Sets the payload format of the application.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">set_payload_format</span><span class="p">(</span><span class="n">payload_format</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li>payload_format: <strong>string</strong> the new payload format.
Example: <code class="highlighter-rouge">custom</code></li>
</ul>
<h3 id="set_custom_payload_functions">set_custom_payload_functions</h3>
<p>Sets the payload functions of the application.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">set_custom_payload_functions</span><span class="p">(</span><span class="n">encoder</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">decoder</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">decoder</code>: <strong>string</strong> Javascript decoder function.</li>
  <li><code class="highlighter-rouge">encoder</code>: <strong>string</strong> Javascript encoder function.</li>
  <li><code class="highlighter-rouge">validator</code>: <strong>string</strong> Javascript validator function.</li>
  <li>
    <p><code class="highlighter-rouge">converter</code>: <strong>string</strong> Javascript converter function.</p>
    <p>Arguments left empty are ignored and won’t be updated.
  Example:</p>
  </li>
</ul>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">decoder_fn</span> <span class="o">=</span> <span class="s">"""function Decoder(payload) {
   return { led: 1 };
}"""</span>
<span class="n">client</span><span class="o">.</span><span class="n">set_custom_payload_functions</span><span class="p">(</span><span class="n">decoder</span><span class="o">=</span><span class="n">decoder_fn</span><span class="p">)</span>
</code></pre>
</div>
<h3 id="unregister">unregister</h3>
<p>Unregisters the application.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>
</code></pre>
</div>
<h3 id="register_device">register_device</h3>
<p>Registers a new device to the application.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">register_device</span><span class="p">(</span><span class="n">dev_id</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">dev_id</code>: <strong>string</strong> the id of the device to be registered.</li>
  <li><code class="highlighter-rouge">device</code>:
    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">devicetest</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"description"</span><span class="p">:</span> <span class="s">"Description"</span><span class="p">,</span>
  <span class="s">"appEui"</span><span class="p">:</span> <span class="s">"0011223344556677"</span><span class="p">,</span>
  <span class="s">"devEui"</span><span class="p">:</span> <span class="s">"9988776655443322"</span><span class="p">,</span>
  <span class="s">"devAddr"</span><span class="p">:</span> <span class="s">"11223344"</span><span class="p">,</span> <span class="c"># remove for OTAA</span>
  <span class="s">"nwkSKey"</span><span class="p">:</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_hex</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="c"># remove for OTAA</span>
  <span class="s">"appSKey"</span><span class="p">:</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_hex</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="c"># remove for OTAA</span>
  <span class="s">"appKey"</span><span class="p">:</span> <span class="n">binascii</span><span class="o">.</span><span class="n">b2a_hex</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="c"># remove for ABP</span>
  <span class="s">"fCntUp"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s">"fCntDown"</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s">"latitude"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="s">"longitude"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s">"altitude"</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
  <span class="s">"attributes"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">"foo"</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s">"disableFCntCheck"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">"uses32BitFCnt"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
</ul>
<h3 id="device">device</h3>
<p>Gives back the <a href="#deviceobject"><strong>Device</strong></a> object of the given id.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">dev_id</code>: <strong>string</strong> the id of the device.</li>
</ul>
<h3 id="devices">devices</h3>
<p>Gives back the list of all the devices registered to the application.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">devices</span><span class="p">()</span>
</code></pre>
</div>
<h3 id="update_device">update_device</h3>
<p>Updates an already existing device of the application.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">update_device</span><span class="p">(</span><span class="n">dev_id</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">dev_id</code>: <strong>string</strong> the id of the device to be updated.</li>
  <li><code class="highlighter-rouge">updates</code>: <strong>dictionary</strong> a dictionary with the fields to be updated in the device.</li>
</ul>
<h3 id="delete_device">delete_device</h3>
<p>Deletes the device with the given id.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="n">delete_device</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">dev_id</code>: <strong>string</strong> the id of the device to be deleted.</li>
</ul>
<h3 id="device-1"><a name="deviceobject"></a>Device</h3>
<p>This objet is returned by the method <code class="highlighter-rouge">device()</code> of the ApplicationClient class. Here are its attributes:</p>
<ul>
  <li><code class="highlighter-rouge">app_id</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">dev_id</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">latitude</code>: <strong>float</strong></li>
  <li><code class="highlighter-rouge">longitude</code>: <strong>float</strong></li>
  <li><code class="highlighter-rouge">altitude</code>: <strong>float</strong></li>
  <li><code class="highlighter-rouge">description</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">attributes</code>: <strong>dictionary</strong></li>
  <li><code class="highlighter-rouge">lorawan_device</code>: <strong>dictionary</strong>
    <ul>
      <li><code class="highlighter-rouge">app_eui</code>: <strong>string</strong> 8 bytes in hexadecimal</li>
      <li><code class="highlighter-rouge">dev_eui</code>: <strong>string</strong> 8 bytes in hexadecimal</li>
      <li><code class="highlighter-rouge">dev_addr</code>: <strong>string</strong> 4 bytes in hexadecimal</li>
      <li><code class="highlighter-rouge">nwk_s_key</code>: <strong>string</strong> 16 bytes in hexadecimal</li>
      <li><code class="highlighter-rouge">app_s_key</code>: <strong>string</strong> 16 bytes in hexadecimal</li>
      <li><code class="highlighter-rouge">app_key</code>: <strong>string</strong> 16 bytes in hexadecimal</li>
      <li><code class="highlighter-rouge">f_cnt_up</code>: <strong>int</strong></li>
      <li><code class="highlighter-rouge">f_cnt_down</code>: <strong>int</strong></li>
      <li><code class="highlighter-rouge">disable_f_cnt_check</code>: <strong>boolean</strong></li>
      <li><code class="highlighter-rouge">uses32_bit_f_cnt</code>: <strong>boolean</strong></li>
    </ul>
  </li>
</ul>
<h3 id="application">Application</h3>
<p>This object is returned by the method <code class="highlighter-rouge">get()</code> of the ApplicationClient class. Here are its attributes:</p>
<ul>
  <li><code class="highlighter-rouge">app_id</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">payload_format</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">decoder</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">encoder</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">converter</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">validator</code>: <strong>string</strong></li>
  <li><code class="highlighter-rouge">register_on_join_access_key</code>: <strong>string</strong></li>
</ul>
<h2 id="handlerclient">HandlerClient</h2>
<p>The class constructor can be called following this scheme:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">HandlerClient</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">access_key</span><span class="p">,</span> <span class="n">discovery_address</span><span class="o">=</span><span class="s">"discovery.thethings.network:1900"</span><span class="p">,</span> <span class="n">cert_path</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
</code></pre>
</div>
<ul>
  <li><code class="highlighter-rouge">app_id</code>: <strong>string</strong> this the name given to the application when it was created.
<img src="5-app-console.png" alt="Screenshot of the console with app section" /></li>
  <li><code class="highlighter-rouge">access_key</code>: <strong>string</strong> this can be found at the bottom of the application page under <strong>ACCESS KEYS</strong>. The key needs the <code class="highlighter-rouge">settings</code> authorization.</li>
  <li><code class="highlighter-rouge">discovery_address</code>: <strong>string</strong> this is the address of the discovery server to use in order to find back the address of the handler to which the application in registered, in the <code class="highlighter-rouge"><span class="p">{</span><span class="err">hostname</span><span class="p">}</span><span class="err">:</span><span class="p">{</span><span class="err">port</span><span class="p">}</span></code> format.</li>
  <li><code class="highlighter-rouge">cert_path</code>: <strong>string</strong> this is the path to the certificate used to connect in a secure way to the discovery server.</li>
</ul>
<h3 id="data">data</h3>
<p>Creates an <a href="#mqttclient"><strong>MQTTClient</strong></a> object.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">handler</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
</code></pre>
</div>
<p>Returns an <a href="#mqttclient"><strong>MQTTClient</strong></a> object.</p>
<h3 id="application-1">application</h3>
<p>Creates an <a href="#applicationclient"><strong>ApplicationClient</strong></a> object</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">handler</span><span class="o">.</span><span class="n">application</span><span class="p">()</span>
</code></pre>
</div>
<p>Returns an <a href="#applicationclient"><strong>ApplicationClient</strong></a> object.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>Errors can happen on connection or on some ApplicationClient’s methods call, for different reasons:</p>
<ul>
  <li>Wrong <code class="highlighter-rouge">app_id</code>, <code class="highlighter-rouge">access_key</code> or <code class="highlighter-rouge">mqtt_address</code> were provided to the constructor.</li>
  <li>The machine may not have access to the network/The MQTT server could be down/Firewall restrictions could prevent connection.</li>
  <li>The client process doesn’t have system capabilities to open a socket</li>
  <li>The MQTT server uses MQTTS, but the client won’t accept the TLS certificate.</li>
  <li>The Application client is not able to get the application or a device.
Errors could also happen when closing connection, in case the disconnection is unexpected. This errors are the most common ones, there are also edges cases not mentioned in this section.</li>
</ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ttn-components.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-navbar.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/vue-footer.js"></script>
    <script src="https://ttnweb.azureedge.net/static/common/js/ga.js"></script>
  </body>
</html>
